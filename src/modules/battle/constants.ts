
import { JsonAbility, JsonPassiveItem, TraumaDefinition } from './types';

// Helper for mocks
const createBonus = (val: number, stat: string = 'phys') => ({ val, stat });

// Simulating the "Time Periods" table from DB
// unit_key: { label: string, is_battle: boolean }
export const TIME_UNIT_CONFIG: Record<string, { label: string, is_battle: boolean }> = {
    'action': { label: 'Действие', is_battle: true },
    'turn': { label: 'Ход', is_battle: true },
    'round': { label: 'Раунд', is_battle: true },
    'scene': { label: 'Сцена', is_battle: false },
    'day': { label: 'Сутки', is_battle: false },
    'instant': { label: 'Мгновенно', is_battle: true },
    'battle': { label: 'Бой', is_battle: true },
    // English fallbacks just in case
    'actions': { label: 'Actions', is_battle: true },
    'rounds': { label: 'Rounds', is_battle: true },
};

export const FUNNY_COOLDOWN_PHRASES = [
    "Страдай весь бой",
    "Уже не в этом бою",
    "Отдохни, путник",
    "В следующей серии",
    "Когда рак на горе свистнет",
    "Слишком долго...",
    "Не дождешься",
    "В следующем сезоне",
    "Забудь об этом",
    "Может лучше чайку?",
    "Спи спокойно",
    "Батарейка села",
    "Император не велит",
    "Варп шторм помешал",
    "Техножрец уже чинит",
    "В следующей жизни",
    "Долго ждать",
    "Как до Луны пешком",
    "Не сегодня",
    "Перегрев реактора",
    "Сбой системы",
    "Архивы закрыты",
    "Жди...",
    "Потом...",
    "Не сейчас",
    "Звезды не сошлись",
    "До второго пришествия",
    "Пока ГМ не разрешит",
    "Выпей зелье и расслабься",
    "Перезагрузка матрицы...",
    "404 Ability Not Found",
    "Энергия на нуле",

        // Игровой сленг и Мета
    "Нерф подъехал",
    "Жди патча",
    "Это в DLC",
    "Купи Premium аккаунт",
    "Сервер не отвечает",
    "Пинг 9999",
    "Текстуры не прогрузились",
    "Крит провал",
    "Единица на кубах",
    "Адмнистрация против",
    "Баг в коде",
    "Скрипт сломался",
    "Вылетел из лобби",
    "Alt + F4 нажми",
    "Press F to pay respect",
    "Миссия невыполнима",
    "Ачивка не получена",
    "Слишком высокий левел",
    "Не хватает маны",
    "Интеллект не прокачан",

    // Фэнтези и Магия
    "Свиток рассыпался",
    "Дракон съел",
    "Руны стерлись",
    "Духи вышли покурить",
    "Зелье прокисло",
    "Гоблины украли кнопку",
    "Магия вне Хогвартса",
    "Ты не пройдешь!",
    "Стрела в колене",
    "Меч заржавел",
    "Принцесса в другом замке",
    "Оракул молчит",
    "Жертва не принята",
    "Алтарь разрушен",
    "Некромант выходной",
    "Мана небесная кончилась",
    "Заклинание на КД",
    "Гримуар захлопнулся",
    "Факел погас",
    "Бард устал петь",

    // Sci-Fi и Технологии
    "Синий экран смерти",
    "Windows обновляется (1%)",
    "Спутник потерян",
    "Гравитация мешает",
    "Драйвер не найден",
    "Процессор сгорел",
    "ИИ в депрессии",
    "Доступ запрещен",
    "Введите пароль",
    "Ошибка 500",
    "Кабель перегрызли",
    "Нет сигнала",
    "Сбой матрицы",
    "Загрузка... 99%",
    "Недостаточно памяти",
    "Протокол 'Отказ'",
    "Система висит",
    "Нужна перезагрузка",
    "Роботы бастуют",
    "Скайнет запретил",

    // Сарказм и Бытовуха
    "Губозакаточная машинка",
    "А харя не треснет?",
    "Держи карман шире",
    "Мечтать не вредно",
    "Ага, разбежался",
    "В очередь, сукин сын!",
    "Давай, до свидания",
    "Ой, всё",
    "Я устал, я ухожу",
    "Ушел на обед",
    "Занято!",
    "Приходите завтра",
    "Ваш звонок очень важен",
    "Не в этой жизни",
    "Забудь как страшный сон",
    "Иди проспись",
    "Хватит тыкать",
    "Кнопка сломалась",
    "Не трогай, это на Новый год",
    "Слишком сложно",
    "Лень загружаться",
    "Попей водички",
    "Успокойся",
    "Дыши глубже",
    "Может, в шашки?",
    "Не твой день",
    "Зря стараешься",
    "Бесполезно",
    "Финита ля комедия",
    "Кина не будет",

    // Абсурд и Вечность
    "Когда ад замерзнет",
    "После дождичка в четверг",
    "Когда солнце погаснет",
    "Через тысячу лет",
    "В следующей эре",
    "Жди Хатико",
    "Энтропия растет",
    "Вселенная схлопнулась",
    "Время — иллюзия",
    "КД длиною в жизнь"
];

// Granular status phrases with steps of 5
export const STATUS_PHRASES: Record<string, string[]> = {
    // 0
    level_0: [
        "Бодр и весел", "Как огурчик", "Готов к труду и обороне", "Ни царапины", 
        "Свеж как майская роза", "Полон энергии", "Здоровье хлещет", 
        "Идеальное состояние", "Максимальная боеготовность", "Скучно без ран",
        // New
        "Сияет как новенький", "Батарейка на 100%", "В лучшей форме", 
        "Хоть сейчас на парад", "Цел и невредим", "Дышит полной грудью", 
        "Абсолютно здоров", "Неуязвим (пока)", "Как после спа-салона", 
        "Пышет жаром жизни", "Ни единого изъяна", "Глаз алмаз, рука тверда", 
        "Мускулы играют", "Готов горы свернуть", "Заряжен успехом", 
        "В ресурсе", "Энергия через край", "Статуя античного героя", 
        "С иголочки", "Даже не вспотел"
    ],
    // -1 to -5
    level_5: [
        "Ссадина", "Ушиб мизинчика", "Комар укусил", "Подорожник поможет", 
        "Обидно, но не больно", "Испорчена прическа", "Задел угол стола", 
        "Легкий дискомфорт", "Требуется поцелуй мамы", "Ничего серьезного",
        // New
        "Пыль на одежде", "Немного запыхался", "Споткнулся", 
        "Уязвленная гордость", "Царапина на доспехе", "Легкое недоумение", 
        "Просто неудачный шаг", "Отряхнулся и пошел", "Даже не заметил", 
        "Больше испугался", "Сбил дыхание", "Порвал рукав", 
        "Слегка потрепан", "Маникюр испорчен", "Враг промахнулся (почти)", 
        "Ерунда", "До свадьбы заживет", "Мелкая неприятность", 
        "Только разозлило", "Нужен пластырь с динозавриком"
    ],
    // -6 to -10
    level_10: [
        "Пара синяков", "Кровь из носа", "Разбита губа", "Фингал под глазом", 
        "Легкое головокружение", "Немного помят", "Нужен пластырь", 
        "Боевое крещение", "Злость растет", "Порезался бумагой (критически)",
        // New
        "Звонкая пощечина судьбы", "Шишка на лбу", "Ноет колено", 
        "Зуб шатается", "Неприятный ушиб", "Ссадина саднит", 
        "Грязь и кровь", "Потерял равновесие", "Легкий шок", 
        "Дыхание сбилось", "Первая кровь", "Нужен лед", 
        "Уже не так весело", "Бодрящая боль", "Глаз дергается", 
        "Слегка подкосились ноги", "Уже не идеально", "Помятый вид", 
        "Требуется передышка", "Вставай, тряпка"
    ],
    // -11 to -15
    level_15: [
        "Хромает", "Держится за бок", "Неприятная рана", "Нужен бинт", 
        "Звенит в ушах", "Слегка контужен", "Кровь капает", 
        "Больно дышать", "Разодран костюм", "Скрипит зубами",
        // New
        "В глазах рябит", "Сильный ушиб", "Ребра ноют", 
        "Движения скованы", "Нужна перевязка", "Болезненная гримаса", 
        "Сплевывает кровь", "Тяжелая одышка", "Начинает уставать", 
        "Прихрамывает на обе ноги", "Голова гудит", "Пальцы дрожат", 
        "Неглубокий порез", "Болевой порог пройден", "Здоровье просело", 
        "Лицо в крови", "Ссадины по всему телу", "Нужен эликсир", 
        "Хватает ртом воздух", "Потрепан жизнью"
    ],
    // -16 to -20
    level_20: [
        "Серьезный порез", "Трещина в ребре", "Один глаз не видит", "Тяжело дышать", 
        "Нужен медик", "Теряет темп", "Броня пробита", 
        "Кровавый кашель", "Шок 1-й степени", "Выглядит плохо",
        // New
        "Нужен скотч и изолента", "Кровь заливает глаза", "Тяжелый удар", 
        "Шаг замедлился", "Сфокусироваться трудно", "Боль мешает думать", 
        "Глубокая рана", "Защита не спасла", "Нужен доктор", 
        "Сердце бешено колотится", "Тошнит от боли", "Руки не слушаются", 
        "Выглядит паршиво", "С трудом стоит", "Нужна помощь", 
        "Серьезный ущерб", "Кровопотеря", "Стиснув зубы", 
        "Тело ноет", "Боевой запал угасает"
    ],
    // -21 to -25
    level_25: [
        "Обильное кровотечение", "Сломан нос", "Вывих плеча", "Шатается", 
        "Бледен как смерть", "Мутится в глазах", "Нужен жгут", 
        "Пахнет жареным", "Плоть подгорела", "Одной ногой в лазарете",
        // New
        "Земля уходит из-под ног", "Держится на силе воли", "Жуткая рана", 
        "Кость треснула", "Теряет ориентацию", "Слабость накатывает", 
        "Рубашка прилипла от крови", "Нужен срочный хил", "Болевой спазм", 
        "Глаза застилает туман", "Не может поднять руку", "Тяжелое сотрясение", 
        "Сложно говорить", "Тело немеет", "Нужны носилки", 
        "Жизнь вытекает", "В шаге от падения", "Критическая ошибка тела", 
        "Плохи дела", "Выглядит как жертва"
    ],
    // -26 to -30
    level_30: [
        "Открытый перелом", "Кишки просятся наружу", "Контузия", "Не чувствует ног", 
        "Ползет к укрытию", "Хрипит", "Заливает кровью пол", 
        "Теряет сознание", "Болевой шок", "Кричит от боли",
        // New
        "Несовместимо с боем", "Кость торчит", "Внутреннее кровотечение", 
        "В глазах темно", "Ноги ватные", "Пытается встать", 
        "Дикая боль", "Сознание плывет", "Нужна операция", 
        "Выглядит как труп", "Кровавый след", "Тело бьет дрожь", 
        "Не может защищаться", "Оружие выпало", "Мольба о помощи", 
        "Разбитое тело", "Шок 2-й степени", "Угасает", 
        "Вид ужасающий", "Держится за рану"
    ],
    // -31 to -35
    level_35: [
        "Видит свет в конце туннеля", "Галлюцинации", "С трудом стоит", "Рука висит плетью", 
        "Пробит легкое", "Нужна реанимация", "Молится богам", 
        "Глаза закатываются", "Почти не реагирует", "Смерть близко",
        // New
        "Бредит", "Слышит голоса предков", "Тело отказывает", 
        "Пульс нитевидный", "Кровавая пена", "Взгляд в никуда", 
        "Не узнает своих", "Жизнь на волоске", "Последние силы", 
        "Агония начинается", "Холодный пот", "Не чувствует боли", 
        "Проваливается в сон", "Нужно чудо", "Смертельная бледность", 
        "Тяжелые хрипы", "Не может двигаться", "Почти конец", 
        "Темнеет в глазах", "Звоните священнику"
    ],
    // -36 to -40 (Critical Threshold Starts)
    level_40: [
        "Должен быть мертв", "Технически труп", "Живой мертвец", "Отказ органов", 
        "Держится на соплях", "Вопреки физике", "Зомби-режим вкл", 
        "Адреналиновый монстр", "Бессмертный пони", "ГМ в шоке",
        // New
        "Сюжетная броня", "Глюк системы", "На чистой ярости", 
        "Отрицание смерти", "Берсерк", "Слишком упрям, чтобы умереть", 
        "Медицина тут бессильна", "Восставший из ада", "Жив назло врагам", 
        "Работает на магии и мате", "Превозмогает", "Мертв, но не знает этого", 
        "Фантомные боли жизни", "Сломанная кукла", "Дух держит тело", 
        "Аномальная живучесть", "Ошибка природы", "За гранью возможного", 
        "Страшнее смерти", "Живой щит"
    ],
    // -41 to -45
    level_45: [
        "Тело не слушается", "Агония", "Предсмертные судороги", "Взгляд в пустоту", 
        "Сердце пропускает удары", "Холодеют конечности", "Душа пакует чемоданы", 
        "Одной ногой в могиле", "Жизнь на ниточке", "Ходячий труп",
        // New
        "Свет гаснет", "Последний вздох застрял", "Смерть дышит в лицо", 
        "Уже видит титры", "Конец игры близок", "Тело остывает", 
        "Разум угас", "Только рефлексы", "Мешок с костями", 
        "Не жилец", "Пора прощаться", "Тьма зовет", 
        "Фатальный сбой", "Сердце останавливается", "Дыхание прерывистое", 
        "Глаза остекленели", "Жизнь уходит", "Почти всё", 
        "Безнадежен", "Финальный отсчет"
    ],
    // -46 to -50
    level_50: [
        "Мясо", "Отбивная", "Почти фарш", "Не жилец", 
        "Только чудо спасет", "Решето", "Кровавое месиво", 
        "Разваливается на части", "Ангел-хранитель уволился", "Свист стоит за плечом",
        // New
        "Кусок плоти", "Биологическая масса", "Разорван в клочья", 
        "Сложно опознать", "Анатомический атлас", "Кровавый туман", 
        "Уже не человек", "Груда костей", "Критическая масса повреждений", 
        "Фарш невозможно провернуть назад", "Смерть пришла", "Ни шанса", 
        "Разобран", "Сломан окончательно", "Конец близок как никогда", 
        "Уничтожен", "Тело разрушено", "Жуткое зрелище", 
        "Без шансов", "Уже на той стороне"
    ],
    // -51 to -55
    level_55: [
        "Соберите его веником", "Биологический мусор", "Уже пахнет", "Черви готовят вилки", 
        "Гробовщик снимает мерки", "Заказывайте отпевание", "R.I.P. Loading...", 
        "Синий экран смерти", "Fatal Error", "Connection Lost",
        // New
        "Груз 200", "Списан в утиль", "Требуется некромант", 
        "Корм для воронов", "История закончилась", "Покойся с миром", 
        "Душа покинула чат", "Отрицательный пульс", "Холодный", 
        "Мертвее мертвого", "Game Over (почти)", "Удаление персонажа...", 
        "Слот освободился", "Биоматериал", "Ошметки", 
        "Стереть с лица земли", "Нужен совок", "Разложение началось", 
        "Конец пути", "Финальные титры"
    ],
    // -56 to -60+ (Fatal)
    level_60: [
        "Точно труп", "Салат", "Фарш", "Соберите его в пакет", "R.I.P.", 
        "Потрачено", "Game Over", "Корм для червей", "Мокрое место", "Аннигилирован",
        // New
        "Дезинтегрирован", "Распылен на атомы", "Стерт из реальности", 
        "Пустое место", "Кровавая лужа", "Ничего не осталось", 
        "А был ли мальчик?", "Ушел в небытие", "Превращен в пыль", 
        "Нужен ДНК тест", "Размазан", "Испарился", 
        "Нулевая целостность", "Абсолютная смерть", "Окончательный финал", 
        "Уничтожен на молекулярном уровне", "Тотальное разрушение", 
        "F", "Удален из базы данных", "Больше не существует"
    ]
};

// --- HELPERS ---

// Helper to correctly declinate Russian words based on count
// titles: [1 file, 2-4 files, 5+ files] -> ['файл', 'файла', 'файлов']
const getDeclension = (number: number, titles: [string, string, string]): string => {
    const cases = [2, 0, 1, 1, 1, 2];
    const index = (number % 100 > 4 && number % 100 < 20) 
        ? 2 
        : cases[(number % 10 < 5) ? number % 10 : 5];
    return titles[index];
};

export const formatDuration = (val: number, unit: string): string => {
    const u = unit?.toLowerCase() || 'turn';
    
    // Turns / Rounds
    if (['turn', 'round', 'ход', 'раунд', 'ходы'].includes(u)) {
        return `${val} ${getDeclension(val, ['ход', 'хода', 'ходов'])}`;
    }

    // Posts
    if (['post', 'пост', 'посты'].includes(u)) {
        return `${val} ${getDeclension(val, ['пост', 'поста', 'постов'])}`;
    }
    
    // Actions
    if (['action', 'действие', 'act', 'действия', 'действий'].includes(u)) {
        return `${val} ${getDeclension(val, ['действие', 'действия', 'действий'])}`;
    }

    // Scenes
    if (['scene', 'сцена', 'сцены'].includes(u)) {
        return `${val} ${getDeclension(val, ['сцена', 'сцены', 'сцен'])}`;
    }
    
    // Hours
    if (['hour', 'hours', 'час', 'часа', 'часов'].includes(u)) {
        return `${val} ${getDeclension(val, ['час', 'часа', 'часов'])}`;
    }

    // Days
    if (['day', 'days', 'день', 'дня', 'дней', 'сутки'].includes(u)) {
        return `${val} ${getDeclension(val, ['день', 'дня', 'дней'])}`;
    }

    // Default fallthrough if unknown unit
    return `${val} ${u}`;
};

export const formatCooldown = (name: string, val: number, unit: string): string => {
    const u = unit?.toLowerCase() || 'turn';

    // Long/Non-combat units get funny phrases
    if (['hour', 'day', 'week', 'scene', 'часы', 'сутки', 'сцена'].includes(u)) {
        // Randomize on every call as requested
        const index = Math.floor(Math.random() * FUNNY_COOLDOWN_PHRASES.length);
        return FUNNY_COOLDOWN_PHRASES[index];
    }

    return formatDuration(val, unit);
};

// --- MOCKS ---

export const MOCK_ABILITIES: JsonAbility[] = [
    {
        _id: 'mock_punch',
        name: 'Unarmed Strike',
        tags: ['phys', 'melee'],
        bonuses: [{ val: 0, stat: 'phys' }],
        cd: 0,
        cd_unit: 'turn',
        dur: 0,
        dur_unit: 'turn',
        desc_mech: 'Basic attack'
    }
];

export const INITIAL_PARTICIPANTS = [];

// Based on the provided screenshot of the 'triggers/trauma' table
export const TRAUMA_DEFINITIONS: Record<string, TraumaDefinition> = {
  crit_mag: { label: 'Тяжкое маг. истощение', value: -15, stack: null },
  crit_phys: { label: 'Крит. физ. повреждение', value: -20, stack: null },
  heavy_phys: { label: 'Тяжелое физ. ранение', value: -15, stack: null },
  heavy_uniq: { label: 'Тяжкое уник. истощение', value: -15, stack: null },
  light_mag: { label: 'Слабое маг. истощение', value: -5, stack: null },
  light_phys: { label: 'Слабое физ. ранение', value: -5, stack: 4, desc: 'Нет штрафа (накапливаемое)' },
  light_uniq: { label: 'Слабое уник. истощение', value: -5, stack: null },
  mid_mag: { label: 'Среднее маг. истощение', value: -10, stack: null },
  mid_phys: { label: 'Среднее физ. ранение', value: -10, stack: null },
  mid_uniq: { label: 'Среднее уник. истощение', value: -10, stack: null },
};
