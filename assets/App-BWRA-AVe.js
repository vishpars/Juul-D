import{c as ye,r as p,b as ee,j as s,f as In,U as Hr,S as ir,A as Vr,X as lr,e as Xr,s as Be,l as Jr}from"./index-C8M5upcy.js";import{r as yt,W as Kr,C as Gr,a as Zr,b as Qr,Z as es,S as ts,c as ns,R as rs,D as ss}from"./zap-DOsArtCC.js";import{C as cr,T as qe,b as Rn,P as os,S as as,a as is}from"./trash-2-BAxENHxM.js";import{S as ls,a as dr}from"./square-CsFyjm7m.js";/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=[["path",{d:"M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z",key:"hh9hay"}],["path",{d:"m3.3 7 8.7 5 8.7-5",key:"g66t2b"}],["path",{d:"M12 22V12",key:"d0xqtd"}]],ds=ye("box",cs);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]],fs=ye("chart-column",us);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}],["path",{d:"M12 8v8",key:"napkw2"}]],ps=ye("circle-plus",hs);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}]],gs=ye("clipboard",ms);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]],Fn=ye("cloud",bs);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],Un=ye("funnel",xs);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=[["circle",{cx:"9",cy:"12",r:"1",key:"1vctgf"}],["circle",{cx:"9",cy:"5",r:"1",key:"hp0tcf"}],["circle",{cx:"9",cy:"19",r:"1",key:"fkjjf6"}],["circle",{cx:"15",cy:"12",r:"1",key:"1tmaij"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["circle",{cx:"15",cy:"19",r:"1",key:"f4zoj3"}]],zt=ye("grip-vertical",vs);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ys=[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]],mn=ye("hard-drive",ys);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=[["path",{d:"M12.409 5.824c-.702.792-1.15 1.496-1.415 2.166l2.153 2.156a.5.5 0 0 1 0 .707l-2.293 2.293a.5.5 0 0 0 0 .707L12 15",key:"idzbju"}],["path",{d:"M13.508 20.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5a5.5 5.5 0 0 1 9.591-3.677.6.6 0 0 0 .818.001A5.5 5.5 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5z",key:"1su70f"}]],_s=ye("heart-crack",ws);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=[["path",{d:"M12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83z",key:"zw3jo"}],["path",{d:"M2 12a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 12",key:"1wduqc"}],["path",{d:"M2 17a1 1 0 0 0 .58.91l8.6 3.91a2 2 0 0 0 1.65 0l8.58-3.9A1 1 0 0 0 22 17",key:"kqbvx6"}]],js=ye("layers",Ns);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=[["path",{d:"M16 5H3",key:"m91uny"}],["path",{d:"M16 12H3",key:"1a2rj7"}],["path",{d:"M9 19H3",key:"s61nz1"}],["path",{d:"m16 16-3 3 3 3",key:"117b85"}],["path",{d:"M21 5v12a2 2 0 0 1-2 2h-6",key:"hey24a"}]],Ss=ye("list-end",Cs);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],ks=ye("list",Es);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ds=[["path",{d:"M5 12h14",key:"1ays0h"}]],Is=ye("minus",Ds);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]],ur=ye("play",Rs);/**
 * @license lucide-react v0.563.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const As=[["path",{d:"M16 3h5v5",key:"1806ms"}],["path",{d:"M8 3H3v5",key:"15dfkv"}],["path",{d:"M12 22v-8.3a4 4 0 0 0-1.172-2.872L3 3",key:"1qrqzj"}],["path",{d:"m15 9 6-6",key:"ko1vev"}]],fr=ye("split",As);function Ts(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return p.useMemo(()=>r=>{t.forEach(a=>a(r))},t)}const en=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";function ht(e){const t=Object.prototype.toString.call(e);return t==="[object Window]"||t==="[object global]"}function An(e){return"nodeType"in e}function we(e){var t,n;return e?ht(e)?e:An(e)&&(t=(n=e.ownerDocument)==null?void 0:n.defaultView)!=null?t:window:window}function Tn(e){const{Document:t}=we(e);return e instanceof t}function kt(e){return ht(e)?!1:e instanceof we(e).HTMLElement}function hr(e){return e instanceof we(e).SVGElement}function pt(e){return e?ht(e)?e.document:An(e)?Tn(e)?e:kt(e)||hr(e)?e.ownerDocument:document:document:document}const Te=en?p.useLayoutEffect:p.useEffect;function tn(e){const t=p.useRef(e);return Te(()=>{t.current=e}),p.useCallback(function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return t.current==null?void 0:t.current(...r)},[])}function $s(){const e=p.useRef(null),t=p.useCallback((r,a)=>{e.current=setInterval(r,a)},[]),n=p.useCallback(()=>{e.current!==null&&(clearInterval(e.current),e.current=null)},[]);return[t,n]}function St(e,t){t===void 0&&(t=[e]);const n=p.useRef(e);return Te(()=>{n.current!==e&&(n.current=e)},t),n}function Dt(e,t){const n=p.useRef();return p.useMemo(()=>{const r=e(n.current);return n.current=r,r},[...t])}function Vt(e){const t=tn(e),n=p.useRef(null),r=p.useCallback(a=>{a!==n.current&&(t==null||t(a,n.current)),n.current=a},[]);return[n,r]}function Xt(e){const t=p.useRef();return p.useEffect(()=>{t.current=e},[e]),t.current}let gn={};function It(e,t){return p.useMemo(()=>{if(t)return t;const n=gn[e]==null?0:gn[e]+1;return gn[e]=n,e+"-"+n},[e,t])}function pr(e){return function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return r.reduce((o,l)=>{const i=Object.entries(l);for(const[d,c]of i){const h=o[d];h!=null&&(o[d]=h+e*c)}return o},{...t})}}const ft=pr(1),Jt=pr(-1);function Ms(e){return"clientX"in e&&"clientY"in e}function nn(e){if(!e)return!1;const{KeyboardEvent:t}=we(e.target);return t&&e instanceof t}function Os(e){if(!e)return!1;const{TouchEvent:t}=we(e.target);return t&&e instanceof t}function Kt(e){if(Os(e)){if(e.touches&&e.touches.length){const{clientX:t,clientY:n}=e.touches[0];return{x:t,y:n}}else if(e.changedTouches&&e.changedTouches.length){const{clientX:t,clientY:n}=e.changedTouches[0];return{x:t,y:n}}}return Ms(e)?{x:e.clientX,y:e.clientY}:null}const Qe=Object.freeze({Translate:{toString(e){if(!e)return;const{x:t,y:n}=e;return"translate3d("+(t?Math.round(t):0)+"px, "+(n?Math.round(n):0)+"px, 0)"}},Scale:{toString(e){if(!e)return;const{scaleX:t,scaleY:n}=e;return"scaleX("+t+") scaleY("+n+")"}},Transform:{toString(e){if(e)return[Qe.Translate.toString(e),Qe.Scale.toString(e)].join(" ")}},Transition:{toString(e){let{property:t,duration:n,easing:r}=e;return t+" "+n+"ms "+r}}}),Wn="a,frame,iframe,input:not([type=hidden]):not(:disabled),select:not(:disabled),textarea:not(:disabled),button:not(:disabled),*[tabindex]";function Ls(e){return e.matches(Wn)?e:e.querySelector(Wn)}const zs={display:"none"};function Ps(e){let{id:t,value:n}=e;return ee.createElement("div",{id:t,style:zs},n)}function qs(e){let{id:t,announcement:n,ariaLiveType:r="assertive"}=e;const a={position:"fixed",top:0,left:0,width:1,height:1,margin:-1,border:0,padding:0,overflow:"hidden",clip:"rect(0 0 0 0)",clipPath:"inset(100%)",whiteSpace:"nowrap"};return ee.createElement("div",{id:t,style:a,role:"status","aria-live":r,"aria-atomic":!0},n)}function Bs(){const[e,t]=p.useState("");return{announce:p.useCallback(r=>{r!=null&&t(r)},[]),announcement:e}}const mr=p.createContext(null);function Fs(e){const t=p.useContext(mr);p.useEffect(()=>{if(!t)throw new Error("useDndMonitor must be used within a children of <DndContext>");return t(e)},[e,t])}function Us(){const[e]=p.useState(()=>new Set),t=p.useCallback(r=>(e.add(r),()=>e.delete(r)),[e]);return[p.useCallback(r=>{let{type:a,event:o}=r;e.forEach(l=>{var i;return(i=l[a])==null?void 0:i.call(l,o)})},[e]),t]}const Ws={draggable:`
    To pick up a draggable item, press the space bar.
    While dragging, use the arrow keys to move the item.
    Press space again to drop the item in its new position, or press escape to cancel.
  `},Ys={onDragStart(e){let{active:t}=e;return"Picked up draggable item "+t.id+"."},onDragOver(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was moved over droppable area "+n.id+".":"Draggable item "+t.id+" is no longer over a droppable area."},onDragEnd(e){let{active:t,over:n}=e;return n?"Draggable item "+t.id+" was dropped over droppable area "+n.id:"Draggable item "+t.id+" was dropped."},onDragCancel(e){let{active:t}=e;return"Dragging was cancelled. Draggable item "+t.id+" was dropped."}};function Hs(e){let{announcements:t=Ys,container:n,hiddenTextDescribedById:r,screenReaderInstructions:a=Ws}=e;const{announce:o,announcement:l}=Bs(),i=It("DndLiveRegion"),[d,c]=p.useState(!1);if(p.useEffect(()=>{c(!0)},[]),Fs(p.useMemo(()=>({onDragStart(f){let{active:y}=f;o(t.onDragStart({active:y}))},onDragMove(f){let{active:y,over:v}=f;t.onDragMove&&o(t.onDragMove({active:y,over:v}))},onDragOver(f){let{active:y,over:v}=f;o(t.onDragOver({active:y,over:v}))},onDragEnd(f){let{active:y,over:v}=f;o(t.onDragEnd({active:y,over:v}))},onDragCancel(f){let{active:y,over:v}=f;o(t.onDragCancel({active:y,over:v}))}}),[o,t])),!d)return null;const h=ee.createElement(ee.Fragment,null,ee.createElement(Ps,{id:r,value:a.draggable}),ee.createElement(qs,{id:i,announcement:l}));return n?yt.createPortal(h,n):h}var ae;(function(e){e.DragStart="dragStart",e.DragMove="dragMove",e.DragEnd="dragEnd",e.DragCancel="dragCancel",e.DragOver="dragOver",e.RegisterDroppable="registerDroppable",e.SetDroppableDisabled="setDroppableDisabled",e.UnregisterDroppable="unregisterDroppable"})(ae||(ae={}));function Gt(){}function Yn(e,t){return p.useMemo(()=>({sensor:e,options:t??{}}),[e,t])}function Vs(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return p.useMemo(()=>[...t].filter(r=>r!=null),[...t])}const $e=Object.freeze({x:0,y:0});function Xs(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function Js(e,t){const n=Kt(e);if(!n)return"0 0";const r={x:(n.x-t.left)/t.width*100,y:(n.y-t.top)/t.height*100};return r.x+"% "+r.y+"%"}function Ks(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return n-r}function Gs(e,t){let{data:{value:n}}=e,{data:{value:r}}=t;return r-n}function Zs(e){let{left:t,top:n,height:r,width:a}=e;return[{x:t,y:n},{x:t+a,y:n},{x:t,y:n+r},{x:t+a,y:n+r}]}function Qs(e,t){if(!e||e.length===0)return null;const[n]=e;return n[t]}function eo(e,t){const n=Math.max(t.top,e.top),r=Math.max(t.left,e.left),a=Math.min(t.left+t.width,e.left+e.width),o=Math.min(t.top+t.height,e.top+e.height),l=a-r,i=o-n;if(r<a&&n<o){const d=t.width*t.height,c=e.width*e.height,h=l*i,f=h/(d+c-h);return Number(f.toFixed(4))}return 0}const to=e=>{let{collisionRect:t,droppableRects:n,droppableContainers:r}=e;const a=[];for(const o of r){const{id:l}=o,i=n.get(l);if(i){const d=eo(i,t);d>0&&a.push({id:l,data:{droppableContainer:o,value:d}})}}return a.sort(Gs)};function no(e,t){const{top:n,left:r,bottom:a,right:o}=t;return n<=e.y&&e.y<=a&&r<=e.x&&e.x<=o}const ro=e=>{let{droppableContainers:t,droppableRects:n,pointerCoordinates:r}=e;if(!r)return[];const a=[];for(const o of t){const{id:l}=o,i=n.get(l);if(i&&no(r,i)){const c=Zs(i).reduce((f,y)=>f+Xs(r,y),0),h=Number((c/4).toFixed(4));a.push({id:l,data:{droppableContainer:o,value:h}})}}return a.sort(Ks)};function so(e,t,n){return{...e,scaleX:t&&n?t.width/n.width:1,scaleY:t&&n?t.height/n.height:1}}function gr(e,t){return e&&t?{x:e.left-t.left,y:e.top-t.top}:$e}function oo(e){return function(n){for(var r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];return a.reduce((l,i)=>({...l,top:l.top+e*i.y,bottom:l.bottom+e*i.y,left:l.left+e*i.x,right:l.right+e*i.x}),{...n})}}const ao=oo(1);function br(e){if(e.startsWith("matrix3d(")){const t=e.slice(9,-1).split(/, /);return{x:+t[12],y:+t[13],scaleX:+t[0],scaleY:+t[5]}}else if(e.startsWith("matrix(")){const t=e.slice(7,-1).split(/, /);return{x:+t[4],y:+t[5],scaleX:+t[0],scaleY:+t[3]}}return null}function io(e,t,n){const r=br(t);if(!r)return e;const{scaleX:a,scaleY:o,x:l,y:i}=r,d=e.left-l-(1-a)*parseFloat(n),c=e.top-i-(1-o)*parseFloat(n.slice(n.indexOf(" ")+1)),h=a?e.width/a:e.width,f=o?e.height/o:e.height;return{width:h,height:f,top:c,right:d+h,bottom:c+f,left:d}}const lo={ignoreTransform:!1};function mt(e,t){t===void 0&&(t=lo);let n=e.getBoundingClientRect();if(t.ignoreTransform){const{transform:c,transformOrigin:h}=we(e).getComputedStyle(e);c&&(n=io(n,c,h))}const{top:r,left:a,width:o,height:l,bottom:i,right:d}=n;return{top:r,left:a,width:o,height:l,bottom:i,right:d}}function Hn(e){return mt(e,{ignoreTransform:!0})}function co(e){const t=e.innerWidth,n=e.innerHeight;return{top:0,left:0,right:t,bottom:n,width:t,height:n}}function uo(e,t){return t===void 0&&(t=we(e).getComputedStyle(e)),t.position==="fixed"}function fo(e,t){t===void 0&&(t=we(e).getComputedStyle(e));const n=/(auto|scroll|overlay)/;return["overflow","overflowX","overflowY"].some(a=>{const o=t[a];return typeof o=="string"?n.test(o):!1})}function $n(e,t){const n=[];function r(a){if(t!=null&&n.length>=t||!a)return n;if(Tn(a)&&a.scrollingElement!=null&&!n.includes(a.scrollingElement))return n.push(a.scrollingElement),n;if(!kt(a)||hr(a)||n.includes(a))return n;const o=we(e).getComputedStyle(a);return a!==e&&fo(a,o)&&n.push(a),uo(a,o)?n:r(a.parentNode)}return e?r(e):n}function xr(e){const[t]=$n(e,1);return t??null}function bn(e){return!en||!e?null:ht(e)?e:An(e)?Tn(e)||e===pt(e).scrollingElement?window:kt(e)?e:null:null}function vr(e){return ht(e)?e.scrollX:e.scrollLeft}function yr(e){return ht(e)?e.scrollY:e.scrollTop}function jn(e){return{x:vr(e),y:yr(e)}}var de;(function(e){e[e.Forward=1]="Forward",e[e.Backward=-1]="Backward"})(de||(de={}));function wr(e){return!en||!e?!1:e===document.scrollingElement}function _r(e){const t={x:0,y:0},n=wr(e)?{height:window.innerHeight,width:window.innerWidth}:{height:e.clientHeight,width:e.clientWidth},r={x:e.scrollWidth-n.width,y:e.scrollHeight-n.height},a=e.scrollTop<=t.y,o=e.scrollLeft<=t.x,l=e.scrollTop>=r.y,i=e.scrollLeft>=r.x;return{isTop:a,isLeft:o,isBottom:l,isRight:i,maxScroll:r,minScroll:t}}const ho={x:.2,y:.2};function po(e,t,n,r,a){let{top:o,left:l,right:i,bottom:d}=n;r===void 0&&(r=10),a===void 0&&(a=ho);const{isTop:c,isBottom:h,isLeft:f,isRight:y}=_r(e),v={x:0,y:0},I={x:0,y:0},w={height:t.height*a.y,width:t.width*a.x};return!c&&o<=t.top+w.height?(v.y=de.Backward,I.y=r*Math.abs((t.top+w.height-o)/w.height)):!h&&d>=t.bottom-w.height&&(v.y=de.Forward,I.y=r*Math.abs((t.bottom-w.height-d)/w.height)),!y&&i>=t.right-w.width?(v.x=de.Forward,I.x=r*Math.abs((t.right-w.width-i)/w.width)):!f&&l<=t.left+w.width&&(v.x=de.Backward,I.x=r*Math.abs((t.left+w.width-l)/w.width)),{direction:v,speed:I}}function mo(e){if(e===document.scrollingElement){const{innerWidth:o,innerHeight:l}=window;return{top:0,left:0,right:o,bottom:l,width:o,height:l}}const{top:t,left:n,right:r,bottom:a}=e.getBoundingClientRect();return{top:t,left:n,right:r,bottom:a,width:e.clientWidth,height:e.clientHeight}}function Nr(e){return e.reduce((t,n)=>ft(t,jn(n)),$e)}function go(e){return e.reduce((t,n)=>t+vr(n),0)}function bo(e){return e.reduce((t,n)=>t+yr(n),0)}function jr(e,t){if(t===void 0&&(t=mt),!e)return;const{top:n,left:r,bottom:a,right:o}=t(e);xr(e)&&(a<=0||o<=0||n>=window.innerHeight||r>=window.innerWidth)&&e.scrollIntoView({block:"center",inline:"center"})}const xo=[["x",["left","right"],go],["y",["top","bottom"],bo]];class Mn{constructor(t,n){this.rect=void 0,this.width=void 0,this.height=void 0,this.top=void 0,this.bottom=void 0,this.right=void 0,this.left=void 0;const r=$n(n),a=Nr(r);this.rect={...t},this.width=t.width,this.height=t.height;for(const[o,l,i]of xo)for(const d of l)Object.defineProperty(this,d,{get:()=>{const c=i(r),h=a[o]-c;return this.rect[d]+h},enumerable:!0});Object.defineProperty(this,"rect",{enumerable:!1})}}class _t{constructor(t){this.target=void 0,this.listeners=[],this.removeAll=()=>{this.listeners.forEach(n=>{var r;return(r=this.target)==null?void 0:r.removeEventListener(...n)})},this.target=t}add(t,n,r){var a;(a=this.target)==null||a.addEventListener(t,n,r),this.listeners.push([t,n,r])}}function vo(e){const{EventTarget:t}=we(e);return e instanceof t?e:pt(e)}function xn(e,t){const n=Math.abs(e.x),r=Math.abs(e.y);return typeof t=="number"?Math.sqrt(n**2+r**2)>t:"x"in t&&"y"in t?n>t.x&&r>t.y:"x"in t?n>t.x:"y"in t?r>t.y:!1}var Ce;(function(e){e.Click="click",e.DragStart="dragstart",e.Keydown="keydown",e.ContextMenu="contextmenu",e.Resize="resize",e.SelectionChange="selectionchange",e.VisibilityChange="visibilitychange"})(Ce||(Ce={}));function Vn(e){e.preventDefault()}function yo(e){e.stopPropagation()}var K;(function(e){e.Space="Space",e.Down="ArrowDown",e.Right="ArrowRight",e.Left="ArrowLeft",e.Up="ArrowUp",e.Esc="Escape",e.Enter="Enter",e.Tab="Tab"})(K||(K={}));const Cr={start:[K.Space,K.Enter],cancel:[K.Esc],end:[K.Space,K.Enter,K.Tab]},wo=(e,t)=>{let{currentCoordinates:n}=t;switch(e.code){case K.Right:return{...n,x:n.x+25};case K.Left:return{...n,x:n.x-25};case K.Down:return{...n,y:n.y+25};case K.Up:return{...n,y:n.y-25}}};class Sr{constructor(t){this.props=void 0,this.autoScrollEnabled=!1,this.referenceCoordinates=void 0,this.listeners=void 0,this.windowListeners=void 0,this.props=t;const{event:{target:n}}=t;this.props=t,this.listeners=new _t(pt(n)),this.windowListeners=new _t(we(n)),this.handleKeyDown=this.handleKeyDown.bind(this),this.handleCancel=this.handleCancel.bind(this),this.attach()}attach(){this.handleStart(),this.windowListeners.add(Ce.Resize,this.handleCancel),this.windowListeners.add(Ce.VisibilityChange,this.handleCancel),setTimeout(()=>this.listeners.add(Ce.Keydown,this.handleKeyDown))}handleStart(){const{activeNode:t,onStart:n}=this.props,r=t.node.current;r&&jr(r),n($e)}handleKeyDown(t){if(nn(t)){const{active:n,context:r,options:a}=this.props,{keyboardCodes:o=Cr,coordinateGetter:l=wo,scrollBehavior:i="smooth"}=a,{code:d}=t;if(o.end.includes(d)){this.handleEnd(t);return}if(o.cancel.includes(d)){this.handleCancel(t);return}const{collisionRect:c}=r.current,h=c?{x:c.left,y:c.top}:$e;this.referenceCoordinates||(this.referenceCoordinates=h);const f=l(t,{active:n,context:r.current,currentCoordinates:h});if(f){const y=Jt(f,h),v={x:0,y:0},{scrollableAncestors:I}=r.current;for(const w of I){const _=t.code,{isTop:R,isRight:D,isLeft:M,isBottom:N,maxScroll:O,minScroll:L}=_r(w),C=mo(w),S={x:Math.min(_===K.Right?C.right-C.width/2:C.right,Math.max(_===K.Right?C.left:C.left+C.width/2,f.x)),y:Math.min(_===K.Down?C.bottom-C.height/2:C.bottom,Math.max(_===K.Down?C.top:C.top+C.height/2,f.y))},A=_===K.Right&&!D||_===K.Left&&!M,q=_===K.Down&&!N||_===K.Up&&!R;if(A&&S.x!==f.x){const E=w.scrollLeft+y.x,U=_===K.Right&&E<=O.x||_===K.Left&&E>=L.x;if(U&&!y.y){w.scrollTo({left:E,behavior:i});return}U?v.x=w.scrollLeft-E:v.x=_===K.Right?w.scrollLeft-O.x:w.scrollLeft-L.x,v.x&&w.scrollBy({left:-v.x,behavior:i});break}else if(q&&S.y!==f.y){const E=w.scrollTop+y.y,U=_===K.Down&&E<=O.y||_===K.Up&&E>=L.y;if(U&&!y.x){w.scrollTo({top:E,behavior:i});return}U?v.y=w.scrollTop-E:v.y=_===K.Down?w.scrollTop-O.y:w.scrollTop-L.y,v.y&&w.scrollBy({top:-v.y,behavior:i});break}}this.handleMove(t,ft(Jt(f,this.referenceCoordinates),v))}}}handleMove(t,n){const{onMove:r}=this.props;t.preventDefault(),r(n)}handleEnd(t){const{onEnd:n}=this.props;t.preventDefault(),this.detach(),n()}handleCancel(t){const{onCancel:n}=this.props;t.preventDefault(),this.detach(),n()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll()}}Sr.activators=[{eventName:"onKeyDown",handler:(e,t,n)=>{let{keyboardCodes:r=Cr,onActivation:a}=t,{active:o}=n;const{code:l}=e.nativeEvent;if(r.start.includes(l)){const i=o.activatorNode.current;return i&&e.target!==i?!1:(e.preventDefault(),a==null||a({event:e.nativeEvent}),!0)}return!1}}];function Xn(e){return!!(e&&"distance"in e)}function Jn(e){return!!(e&&"delay"in e)}class On{constructor(t,n,r){var a;r===void 0&&(r=vo(t.event.target)),this.props=void 0,this.events=void 0,this.autoScrollEnabled=!0,this.document=void 0,this.activated=!1,this.initialCoordinates=void 0,this.timeoutId=null,this.listeners=void 0,this.documentListeners=void 0,this.windowListeners=void 0,this.props=t,this.events=n;const{event:o}=t,{target:l}=o;this.props=t,this.events=n,this.document=pt(l),this.documentListeners=new _t(this.document),this.listeners=new _t(r),this.windowListeners=new _t(we(l)),this.initialCoordinates=(a=Kt(o))!=null?a:$e,this.handleStart=this.handleStart.bind(this),this.handleMove=this.handleMove.bind(this),this.handleEnd=this.handleEnd.bind(this),this.handleCancel=this.handleCancel.bind(this),this.handleKeydown=this.handleKeydown.bind(this),this.removeTextSelection=this.removeTextSelection.bind(this),this.attach()}attach(){const{events:t,props:{options:{activationConstraint:n,bypassActivationConstraint:r}}}=this;if(this.listeners.add(t.move.name,this.handleMove,{passive:!1}),this.listeners.add(t.end.name,this.handleEnd),t.cancel&&this.listeners.add(t.cancel.name,this.handleCancel),this.windowListeners.add(Ce.Resize,this.handleCancel),this.windowListeners.add(Ce.DragStart,Vn),this.windowListeners.add(Ce.VisibilityChange,this.handleCancel),this.windowListeners.add(Ce.ContextMenu,Vn),this.documentListeners.add(Ce.Keydown,this.handleKeydown),n){if(r!=null&&r({event:this.props.event,activeNode:this.props.activeNode,options:this.props.options}))return this.handleStart();if(Jn(n)){this.timeoutId=setTimeout(this.handleStart,n.delay),this.handlePending(n);return}if(Xn(n)){this.handlePending(n);return}}this.handleStart()}detach(){this.listeners.removeAll(),this.windowListeners.removeAll(),setTimeout(this.documentListeners.removeAll,50),this.timeoutId!==null&&(clearTimeout(this.timeoutId),this.timeoutId=null)}handlePending(t,n){const{active:r,onPending:a}=this.props;a(r,t,this.initialCoordinates,n)}handleStart(){const{initialCoordinates:t}=this,{onStart:n}=this.props;t&&(this.activated=!0,this.documentListeners.add(Ce.Click,yo,{capture:!0}),this.removeTextSelection(),this.documentListeners.add(Ce.SelectionChange,this.removeTextSelection),n(t))}handleMove(t){var n;const{activated:r,initialCoordinates:a,props:o}=this,{onMove:l,options:{activationConstraint:i}}=o;if(!a)return;const d=(n=Kt(t))!=null?n:$e,c=Jt(a,d);if(!r&&i){if(Xn(i)){if(i.tolerance!=null&&xn(c,i.tolerance))return this.handleCancel();if(xn(c,i.distance))return this.handleStart()}if(Jn(i)&&xn(c,i.tolerance))return this.handleCancel();this.handlePending(i,c);return}t.cancelable&&t.preventDefault(),l(d)}handleEnd(){const{onAbort:t,onEnd:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleCancel(){const{onAbort:t,onCancel:n}=this.props;this.detach(),this.activated||t(this.props.active),n()}handleKeydown(t){t.code===K.Esc&&this.handleCancel()}removeTextSelection(){var t;(t=this.document.getSelection())==null||t.removeAllRanges()}}const _o={cancel:{name:"pointercancel"},move:{name:"pointermove"},end:{name:"pointerup"}};class Er extends On{constructor(t){const{event:n}=t,r=pt(n.target);super(t,_o,r)}}Er.activators=[{eventName:"onPointerDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return!n.isPrimary||n.button!==0?!1:(r==null||r({event:n}),!0)}}];const No={move:{name:"mousemove"},end:{name:"mouseup"}};var Cn;(function(e){e[e.RightClick=2]="RightClick"})(Cn||(Cn={}));class kr extends On{constructor(t){super(t,No,pt(t.event.target))}}kr.activators=[{eventName:"onMouseDown",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;return n.button===Cn.RightClick?!1:(r==null||r({event:n}),!0)}}];const vn={cancel:{name:"touchcancel"},move:{name:"touchmove"},end:{name:"touchend"}};class Dr extends On{constructor(t){super(t,vn)}static setup(){return window.addEventListener(vn.move.name,t,{capture:!1,passive:!1}),function(){window.removeEventListener(vn.move.name,t)};function t(){}}}Dr.activators=[{eventName:"onTouchStart",handler:(e,t)=>{let{nativeEvent:n}=e,{onActivation:r}=t;const{touches:a}=n;return a.length>1?!1:(r==null||r({event:n}),!0)}}];var Nt;(function(e){e[e.Pointer=0]="Pointer",e[e.DraggableRect=1]="DraggableRect"})(Nt||(Nt={}));var Zt;(function(e){e[e.TreeOrder=0]="TreeOrder",e[e.ReversedTreeOrder=1]="ReversedTreeOrder"})(Zt||(Zt={}));function jo(e){let{acceleration:t,activator:n=Nt.Pointer,canScroll:r,draggingRect:a,enabled:o,interval:l=5,order:i=Zt.TreeOrder,pointerCoordinates:d,scrollableAncestors:c,scrollableAncestorRects:h,delta:f,threshold:y}=e;const v=So({delta:f,disabled:!o}),[I,w]=$s(),_=p.useRef({x:0,y:0}),R=p.useRef({x:0,y:0}),D=p.useMemo(()=>{switch(n){case Nt.Pointer:return d?{top:d.y,bottom:d.y,left:d.x,right:d.x}:null;case Nt.DraggableRect:return a}},[n,a,d]),M=p.useRef(null),N=p.useCallback(()=>{const L=M.current;if(!L)return;const C=_.current.x*R.current.x,S=_.current.y*R.current.y;L.scrollBy(C,S)},[]),O=p.useMemo(()=>i===Zt.TreeOrder?[...c].reverse():c,[i,c]);p.useEffect(()=>{if(!o||!c.length||!D){w();return}for(const L of O){if((r==null?void 0:r(L))===!1)continue;const C=c.indexOf(L),S=h[C];if(!S)continue;const{direction:A,speed:q}=po(L,S,D,t,y);for(const E of["x","y"])v[E][A[E]]||(q[E]=0,A[E]=0);if(q.x>0||q.y>0){w(),M.current=L,I(N,l),_.current=q,R.current=A;return}}_.current={x:0,y:0},R.current={x:0,y:0},w()},[t,N,r,w,o,l,JSON.stringify(D),JSON.stringify(v),I,c,O,h,JSON.stringify(y)])}const Co={x:{[de.Backward]:!1,[de.Forward]:!1},y:{[de.Backward]:!1,[de.Forward]:!1}};function So(e){let{delta:t,disabled:n}=e;const r=Xt(t);return Dt(a=>{if(n||!r||!a)return Co;const o={x:Math.sign(t.x-r.x),y:Math.sign(t.y-r.y)};return{x:{[de.Backward]:a.x[de.Backward]||o.x===-1,[de.Forward]:a.x[de.Forward]||o.x===1},y:{[de.Backward]:a.y[de.Backward]||o.y===-1,[de.Forward]:a.y[de.Forward]||o.y===1}}},[n,t,r])}function Eo(e,t){const n=t!=null?e.get(t):void 0,r=n?n.node.current:null;return Dt(a=>{var o;return t==null?null:(o=r??a)!=null?o:null},[r,t])}function ko(e,t){return p.useMemo(()=>e.reduce((n,r)=>{const{sensor:a}=r,o=a.activators.map(l=>({eventName:l.eventName,handler:t(l.handler,r)}));return[...n,...o]},[]),[e,t])}var Et;(function(e){e[e.Always=0]="Always",e[e.BeforeDragging=1]="BeforeDragging",e[e.WhileDragging=2]="WhileDragging"})(Et||(Et={}));var Sn;(function(e){e.Optimized="optimized"})(Sn||(Sn={}));const Kn=new Map;function Do(e,t){let{dragging:n,dependencies:r,config:a}=t;const[o,l]=p.useState(null),{frequency:i,measure:d,strategy:c}=a,h=p.useRef(e),f=_(),y=St(f),v=p.useCallback(function(R){R===void 0&&(R=[]),!y.current&&l(D=>D===null?R:D.concat(R.filter(M=>!D.includes(M))))},[y]),I=p.useRef(null),w=Dt(R=>{if(f&&!n)return Kn;if(!R||R===Kn||h.current!==e||o!=null){const D=new Map;for(let M of e){if(!M)continue;if(o&&o.length>0&&!o.includes(M.id)&&M.rect.current){D.set(M.id,M.rect.current);continue}const N=M.node.current,O=N?new Mn(d(N),N):null;M.rect.current=O,O&&D.set(M.id,O)}return D}return R},[e,o,n,f,d]);return p.useEffect(()=>{h.current=e},[e]),p.useEffect(()=>{f||v()},[n,f]),p.useEffect(()=>{o&&o.length>0&&l(null)},[JSON.stringify(o)]),p.useEffect(()=>{f||typeof i!="number"||I.current!==null||(I.current=setTimeout(()=>{v(),I.current=null},i))},[i,f,v,...r]),{droppableRects:w,measureDroppableContainers:v,measuringScheduled:o!=null};function _(){switch(c){case Et.Always:return!1;case Et.BeforeDragging:return n;default:return!n}}}function Ln(e,t){return Dt(n=>e?n||(typeof t=="function"?t(e):e):null,[t,e])}function Io(e,t){return Ln(e,t)}function Ro(e){let{callback:t,disabled:n}=e;const r=tn(t),a=p.useMemo(()=>{if(n||typeof window>"u"||typeof window.MutationObserver>"u")return;const{MutationObserver:o}=window;return new o(r)},[r,n]);return p.useEffect(()=>()=>a==null?void 0:a.disconnect(),[a]),a}function rn(e){let{callback:t,disabled:n}=e;const r=tn(t),a=p.useMemo(()=>{if(n||typeof window>"u"||typeof window.ResizeObserver>"u")return;const{ResizeObserver:o}=window;return new o(r)},[n]);return p.useEffect(()=>()=>a==null?void 0:a.disconnect(),[a]),a}function Ao(e){return new Mn(mt(e),e)}function Gn(e,t,n){t===void 0&&(t=Ao);const[r,a]=p.useState(null);function o(){a(d=>{if(!e)return null;if(e.isConnected===!1){var c;return(c=d??n)!=null?c:null}const h=t(e);return JSON.stringify(d)===JSON.stringify(h)?d:h})}const l=Ro({callback(d){if(e)for(const c of d){const{type:h,target:f}=c;if(h==="childList"&&f instanceof HTMLElement&&f.contains(e)){o();break}}}}),i=rn({callback:o});return Te(()=>{o(),e?(i==null||i.observe(e),l==null||l.observe(document.body,{childList:!0,subtree:!0})):(i==null||i.disconnect(),l==null||l.disconnect())},[e]),r}function To(e){const t=Ln(e);return gr(e,t)}const Zn=[];function $o(e){const t=p.useRef(e),n=Dt(r=>e?r&&r!==Zn&&e&&t.current&&e.parentNode===t.current.parentNode?r:$n(e):Zn,[e]);return p.useEffect(()=>{t.current=e},[e]),n}function Mo(e){const[t,n]=p.useState(null),r=p.useRef(e),a=p.useCallback(o=>{const l=bn(o.target);l&&n(i=>i?(i.set(l,jn(l)),new Map(i)):null)},[]);return p.useEffect(()=>{const o=r.current;if(e!==o){l(o);const i=e.map(d=>{const c=bn(d);return c?(c.addEventListener("scroll",a,{passive:!0}),[c,jn(c)]):null}).filter(d=>d!=null);n(i.length?new Map(i):null),r.current=e}return()=>{l(e),l(o)};function l(i){i.forEach(d=>{const c=bn(d);c==null||c.removeEventListener("scroll",a)})}},[a,e]),p.useMemo(()=>e.length?t?Array.from(t.values()).reduce((o,l)=>ft(o,l),$e):Nr(e):$e,[e,t])}function Qn(e,t){t===void 0&&(t=[]);const n=p.useRef(null);return p.useEffect(()=>{n.current=null},t),p.useEffect(()=>{const r=e!==$e;r&&!n.current&&(n.current=e),!r&&n.current&&(n.current=null)},[e]),n.current?Jt(e,n.current):$e}function Oo(e){p.useEffect(()=>{if(!en)return;const t=e.map(n=>{let{sensor:r}=n;return r.setup==null?void 0:r.setup()});return()=>{for(const n of t)n==null||n()}},e.map(t=>{let{sensor:n}=t;return n}))}function Lo(e,t){return p.useMemo(()=>e.reduce((n,r)=>{let{eventName:a,handler:o}=r;return n[a]=l=>{o(l,t)},n},{}),[e,t])}function Ir(e){return p.useMemo(()=>e?co(e):null,[e])}const er=[];function zo(e,t){t===void 0&&(t=mt);const[n]=e,r=Ir(n?we(n):null),[a,o]=p.useState(er);function l(){o(()=>e.length?e.map(d=>wr(d)?r:new Mn(t(d),d)):er)}const i=rn({callback:l});return Te(()=>{i==null||i.disconnect(),l(),e.forEach(d=>i==null?void 0:i.observe(d))},[e]),a}function Rr(e){if(!e)return null;if(e.children.length>1)return e;const t=e.children[0];return kt(t)?t:e}function Po(e){let{measure:t}=e;const[n,r]=p.useState(null),a=p.useCallback(c=>{for(const{target:h}of c)if(kt(h)){r(f=>{const y=t(h);return f?{...f,width:y.width,height:y.height}:y});break}},[t]),o=rn({callback:a}),l=p.useCallback(c=>{const h=Rr(c);o==null||o.disconnect(),h&&(o==null||o.observe(h)),r(h?t(h):null)},[t,o]),[i,d]=Vt(l);return p.useMemo(()=>({nodeRef:i,rect:n,setRef:d}),[n,i,d])}const qo=[{sensor:Er,options:{}},{sensor:Sr,options:{}}],Bo={current:{}},Wt={draggable:{measure:Hn},droppable:{measure:Hn,strategy:Et.WhileDragging,frequency:Sn.Optimized},dragOverlay:{measure:mt}};class jt extends Map{get(t){var n;return t!=null&&(n=super.get(t))!=null?n:void 0}toArray(){return Array.from(this.values())}getEnabled(){return this.toArray().filter(t=>{let{disabled:n}=t;return!n})}getNodeFor(t){var n,r;return(n=(r=this.get(t))==null?void 0:r.node.current)!=null?n:void 0}}const Fo={activatorEvent:null,active:null,activeNode:null,activeNodeRect:null,collisions:null,containerNodeRect:null,draggableNodes:new Map,droppableRects:new Map,droppableContainers:new jt,over:null,dragOverlay:{nodeRef:{current:null},rect:null,setRef:Gt},scrollableAncestors:[],scrollableAncestorRects:[],measuringConfiguration:Wt,measureDroppableContainers:Gt,windowRect:null,measuringScheduled:!1},Ar={activatorEvent:null,activators:[],active:null,activeNodeRect:null,ariaDescribedById:{draggable:""},dispatch:Gt,draggableNodes:new Map,over:null,measureDroppableContainers:Gt},Rt=p.createContext(Ar),Tr=p.createContext(Fo);function Uo(){return{draggable:{active:null,initialCoordinates:{x:0,y:0},nodes:new Map,translate:{x:0,y:0}},droppable:{containers:new jt}}}function Wo(e,t){switch(t.type){case ae.DragStart:return{...e,draggable:{...e.draggable,initialCoordinates:t.initialCoordinates,active:t.active}};case ae.DragMove:return e.draggable.active==null?e:{...e,draggable:{...e.draggable,translate:{x:t.coordinates.x-e.draggable.initialCoordinates.x,y:t.coordinates.y-e.draggable.initialCoordinates.y}}};case ae.DragEnd:case ae.DragCancel:return{...e,draggable:{...e.draggable,active:null,initialCoordinates:{x:0,y:0},translate:{x:0,y:0}}};case ae.RegisterDroppable:{const{element:n}=t,{id:r}=n,a=new jt(e.droppable.containers);return a.set(r,n),{...e,droppable:{...e.droppable,containers:a}}}case ae.SetDroppableDisabled:{const{id:n,key:r,disabled:a}=t,o=e.droppable.containers.get(n);if(!o||r!==o.key)return e;const l=new jt(e.droppable.containers);return l.set(n,{...o,disabled:a}),{...e,droppable:{...e.droppable,containers:l}}}case ae.UnregisterDroppable:{const{id:n,key:r}=t,a=e.droppable.containers.get(n);if(!a||r!==a.key)return e;const o=new jt(e.droppable.containers);return o.delete(n),{...e,droppable:{...e.droppable,containers:o}}}default:return e}}function Yo(e){let{disabled:t}=e;const{active:n,activatorEvent:r,draggableNodes:a}=p.useContext(Rt),o=Xt(r),l=Xt(n==null?void 0:n.id);return p.useEffect(()=>{if(!t&&!r&&o&&l!=null){if(!nn(o)||document.activeElement===o.target)return;const i=a.get(l);if(!i)return;const{activatorNode:d,node:c}=i;if(!d.current&&!c.current)return;requestAnimationFrame(()=>{for(const h of[d.current,c.current]){if(!h)continue;const f=Ls(h);if(f){f.focus();break}}})}},[r,t,a,l,o]),null}function $r(e,t){let{transform:n,...r}=t;return e!=null&&e.length?e.reduce((a,o)=>o({transform:a,...r}),n):n}function Ho(e){return p.useMemo(()=>({draggable:{...Wt.draggable,...e==null?void 0:e.draggable},droppable:{...Wt.droppable,...e==null?void 0:e.droppable},dragOverlay:{...Wt.dragOverlay,...e==null?void 0:e.dragOverlay}}),[e==null?void 0:e.draggable,e==null?void 0:e.droppable,e==null?void 0:e.dragOverlay])}function Vo(e){let{activeNode:t,measure:n,initialRect:r,config:a=!0}=e;const o=p.useRef(!1),{x:l,y:i}=typeof a=="boolean"?{x:a,y:a}:a;Te(()=>{if(!l&&!i||!t){o.current=!1;return}if(o.current||!r)return;const c=t==null?void 0:t.node.current;if(!c||c.isConnected===!1)return;const h=n(c),f=gr(h,r);if(l||(f.x=0),i||(f.y=0),o.current=!0,Math.abs(f.x)>0||Math.abs(f.y)>0){const y=xr(c);y&&y.scrollBy({top:f.y,left:f.x})}},[t,l,i,r,n])}const sn=p.createContext({...$e,scaleX:1,scaleY:1});var Ge;(function(e){e[e.Uninitialized=0]="Uninitialized",e[e.Initializing=1]="Initializing",e[e.Initialized=2]="Initialized"})(Ge||(Ge={}));const Xo=p.memo(function(t){var n,r,a,o;let{id:l,accessibility:i,autoScroll:d=!0,children:c,sensors:h=qo,collisionDetection:f=to,measuring:y,modifiers:v,...I}=t;const w=p.useReducer(Wo,void 0,Uo),[_,R]=w,[D,M]=Us(),[N,O]=p.useState(Ge.Uninitialized),L=N===Ge.Initialized,{draggable:{active:C,nodes:S,translate:A},droppable:{containers:q}}=_,E=C!=null?S.get(C):null,U=p.useRef({initial:null,translated:null}),g=p.useMemo(()=>{var ce;return C!=null?{id:C,data:(ce=E==null?void 0:E.data)!=null?ce:Bo,rect:U}:null},[C,E]),j=p.useRef(null),[B,G]=p.useState(null),[T,Q]=p.useState(null),Z=St(I,Object.values(I)),Fe=It("DndDescribedBy",l),Me=p.useMemo(()=>q.getEnabled(),[q]),ie=Ho(y),{droppableRects:ne,measureDroppableContainers:le,measuringScheduled:Ue}=Do(Me,{dragging:L,dependencies:[A.x,A.y],config:ie.droppable}),ge=Eo(S,C),at=p.useMemo(()=>T?Kt(T):null,[T]),Se=pn(),Ee=Io(ge,ie.draggable.measure);Vo({activeNode:C!=null?S.get(C):null,config:Se.layoutShiftCompensation,initialRect:Ee,measure:ie.draggable.measure});const J=Gn(ge,ie.draggable.measure,Ee),et=Gn(ge?ge.parentElement:null),be=p.useRef({activatorEvent:null,active:null,activeNode:ge,collisionRect:null,collisions:null,droppableRects:ne,draggableNodes:S,draggingNode:null,draggingNodeRect:null,droppableContainers:q,over:null,scrollableAncestors:[],scrollAdjustedTranslate:null}),We=q.getNodeFor((n=be.current.over)==null?void 0:n.id),ke=Po({measure:ie.dragOverlay.measure}),ze=(r=ke.nodeRef.current)!=null?r:ge,te=L?(a=ke.rect)!=null?a:J:null,re=!!(ke.nodeRef.current&&ke.rect),gt=To(re?null:J),bt=Ir(ze?we(ze):null),De=$o(L?We??ge:null),it=zo(De),lt=$r(v,{transform:{x:A.x-gt.x,y:A.y-gt.y,scaleX:1,scaleY:1},activatorEvent:T,active:g,activeNodeRect:J,containerNodeRect:et,draggingNodeRect:te,over:be.current.over,overlayNodeRect:ke.rect,scrollableAncestors:De,scrollableAncestorRects:it,windowRect:bt}),At=at?ft(at,A):null,Tt=Mo(De),an=Qn(Tt),ln=Qn(Tt,[J]),Ye=ft(lt,an),He=te?ao(te,lt):null,tt=g&&He?f({active:g,collisionRect:He,droppableRects:ne,droppableContainers:Me,pointerCoordinates:At}):null,$t=Qs(tt,"id"),[Ie,Mt]=p.useState(null),cn=re?lt:ft(lt,ln),dn=so(cn,(o=Ie==null?void 0:Ie.rect)!=null?o:null,J),xt=p.useRef(null),Ot=p.useCallback((ce,xe)=>{let{sensor:he,options:Oe}=xe;if(j.current==null)return;const ue=S.get(j.current);if(!ue)return;const fe=ce.nativeEvent,je=new he({active:j.current,activeNode:ue,event:fe,options:Oe,context:be,onAbort(se){if(!S.get(se))return;const{onDragAbort:_e}=Z.current,Ae={id:se};_e==null||_e(Ae),D({type:"onDragAbort",event:Ae})},onPending(se,Re,_e,Ae){if(!S.get(se))return;const{onDragPending:Pe}=Z.current,Le={id:se,constraint:Re,initialCoordinates:_e,offset:Ae};Pe==null||Pe(Le),D({type:"onDragPending",event:Le})},onStart(se){const Re=j.current;if(Re==null)return;const _e=S.get(Re);if(!_e)return;const{onDragStart:Ae}=Z.current,nt={activatorEvent:fe,active:{id:Re,data:_e.data,rect:U}};yt.unstable_batchedUpdates(()=>{Ae==null||Ae(nt),O(Ge.Initializing),R({type:ae.DragStart,initialCoordinates:se,active:Re}),D({type:"onDragStart",event:nt}),G(xt.current),Q(fe)})},onMove(se){R({type:ae.DragMove,coordinates:se})},onEnd:Ve(ae.DragEnd),onCancel:Ve(ae.DragCancel)});xt.current=je;function Ve(se){return async function(){const{active:_e,collisions:Ae,over:nt,scrollAdjustedTranslate:Pe}=be.current;let Le=null;if(_e&&Pe){const{cancelDrop:rt}=Z.current;Le={activatorEvent:fe,active:_e,collisions:Ae,delta:Pe,over:nt},se===ae.DragEnd&&typeof rt=="function"&&await Promise.resolve(rt(Le))&&(se=ae.DragCancel)}j.current=null,yt.unstable_batchedUpdates(()=>{R({type:se}),O(Ge.Uninitialized),Mt(null),G(null),Q(null),xt.current=null;const rt=se===ae.DragEnd?"onDragEnd":"onDragCancel";if(Le){const u=Z.current[rt];u==null||u(Le),D({type:rt,event:Le})}})}}},[S]),un=p.useCallback((ce,xe)=>(he,Oe)=>{const ue=he.nativeEvent,fe=S.get(Oe);if(j.current!==null||!fe||ue.dndKit||ue.defaultPrevented)return;const je={active:fe};ce(he,xe.options,je)===!0&&(ue.dndKit={capturedBy:xe.sensor},j.current=Oe,Ot(he,xe))},[S,Ot]),Lt=ko(h,un);Oo(h),Te(()=>{J&&N===Ge.Initializing&&O(Ge.Initialized)},[J,N]),p.useEffect(()=>{const{onDragMove:ce}=Z.current,{active:xe,activatorEvent:he,collisions:Oe,over:ue}=be.current;if(!xe||!he)return;const fe={active:xe,activatorEvent:he,collisions:Oe,delta:{x:Ye.x,y:Ye.y},over:ue};yt.unstable_batchedUpdates(()=>{ce==null||ce(fe),D({type:"onDragMove",event:fe})})},[Ye.x,Ye.y]),p.useEffect(()=>{const{active:ce,activatorEvent:xe,collisions:he,droppableContainers:Oe,scrollAdjustedTranslate:ue}=be.current;if(!ce||j.current==null||!xe||!ue)return;const{onDragOver:fe}=Z.current,je=Oe.get($t),Ve=je&&je.rect.current?{id:je.id,rect:je.rect.current,data:je.data,disabled:je.disabled}:null,se={active:ce,activatorEvent:xe,collisions:he,delta:{x:ue.x,y:ue.y},over:Ve};yt.unstable_batchedUpdates(()=>{Mt(Ve),fe==null||fe(se),D({type:"onDragOver",event:se})})},[$t]),Te(()=>{be.current={activatorEvent:T,active:g,activeNode:ge,collisionRect:He,collisions:tt,droppableRects:ne,draggableNodes:S,draggingNode:ze,draggingNodeRect:te,droppableContainers:q,over:Ie,scrollableAncestors:De,scrollAdjustedTranslate:Ye},U.current={initial:te,translated:He}},[g,ge,tt,He,S,ze,te,ne,q,Ie,De,Ye]),jo({...Se,delta:A,draggingRect:He,pointerCoordinates:At,scrollableAncestors:De,scrollableAncestorRects:it});const fn=p.useMemo(()=>({active:g,activeNode:ge,activeNodeRect:J,activatorEvent:T,collisions:tt,containerNodeRect:et,dragOverlay:ke,draggableNodes:S,droppableContainers:q,droppableRects:ne,over:Ie,measureDroppableContainers:le,scrollableAncestors:De,scrollableAncestorRects:it,measuringConfiguration:ie,measuringScheduled:Ue,windowRect:bt}),[g,ge,J,T,tt,et,ke,S,q,ne,Ie,le,De,it,ie,Ue,bt]),hn=p.useMemo(()=>({activatorEvent:T,activators:Lt,active:g,activeNodeRect:J,ariaDescribedById:{draggable:Fe},dispatch:R,draggableNodes:S,over:Ie,measureDroppableContainers:le}),[T,Lt,g,J,R,Fe,S,Ie,le]);return ee.createElement(mr.Provider,{value:M},ee.createElement(Rt.Provider,{value:hn},ee.createElement(Tr.Provider,{value:fn},ee.createElement(sn.Provider,{value:dn},c)),ee.createElement(Yo,{disabled:(i==null?void 0:i.restoreFocus)===!1})),ee.createElement(Hs,{...i,hiddenTextDescribedById:Fe}));function pn(){const ce=(B==null?void 0:B.autoScrollEnabled)===!1,xe=typeof d=="object"?d.enabled===!1:d===!1,he=L&&!ce&&!xe;return typeof d=="object"?{...d,enabled:he}:{enabled:he}}}),Jo=p.createContext(null),tr="button",Ko="Draggable";function Mr(e){let{id:t,data:n,disabled:r=!1,attributes:a}=e;const o=It(Ko),{activators:l,activatorEvent:i,active:d,activeNodeRect:c,ariaDescribedById:h,draggableNodes:f,over:y}=p.useContext(Rt),{role:v=tr,roleDescription:I="draggable",tabIndex:w=0}=a??{},_=(d==null?void 0:d.id)===t,R=p.useContext(_?sn:Jo),[D,M]=Vt(),[N,O]=Vt(),L=Lo(l,t),C=St(n);Te(()=>(f.set(t,{id:t,key:o,node:D,activatorNode:N,data:C}),()=>{const A=f.get(t);A&&A.key===o&&f.delete(t)}),[f,t]);const S=p.useMemo(()=>({role:v,tabIndex:w,"aria-disabled":r,"aria-pressed":_&&v===tr?!0:void 0,"aria-roledescription":I,"aria-describedby":h.draggable}),[r,v,w,_,I,h.draggable]);return{active:d,activatorEvent:i,activeNodeRect:c,attributes:S,isDragging:_,listeners:r?void 0:L,node:D,over:y,setNodeRef:M,setActivatorNodeRef:O,transform:R}}function Or(){return p.useContext(Tr)}const Go="Droppable",Zo={timeout:25};function zn(e){let{data:t,disabled:n=!1,id:r,resizeObserverConfig:a}=e;const o=It(Go),{active:l,dispatch:i,over:d,measureDroppableContainers:c}=p.useContext(Rt),h=p.useRef({disabled:n}),f=p.useRef(!1),y=p.useRef(null),v=p.useRef(null),{disabled:I,updateMeasurementsFor:w,timeout:_}={...Zo,...a},R=St(w??r),D=p.useCallback(()=>{if(!f.current){f.current=!0;return}v.current!=null&&clearTimeout(v.current),v.current=setTimeout(()=>{c(Array.isArray(R.current)?R.current:[R.current]),v.current=null},_)},[_]),M=rn({callback:D,disabled:I||!l}),N=p.useCallback((S,A)=>{M&&(A&&(M.unobserve(A),f.current=!1),S&&M.observe(S))},[M]),[O,L]=Vt(N),C=St(t);return p.useEffect(()=>{!M||!O.current||(M.disconnect(),f.current=!1,M.observe(O.current))},[O,M]),p.useEffect(()=>(i({type:ae.RegisterDroppable,element:{id:r,key:o,disabled:n,node:O,rect:y,data:C}}),()=>i({type:ae.UnregisterDroppable,key:o,id:r})),[r]),p.useEffect(()=>{n!==h.current.disabled&&(i({type:ae.SetDroppableDisabled,id:r,key:o,disabled:n}),h.current.disabled=n)},[r,o,n,i]),{active:l,rect:y,isOver:(d==null?void 0:d.id)===r,node:O,over:d,setNodeRef:L}}function Qo(e){let{animation:t,children:n}=e;const[r,a]=p.useState(null),[o,l]=p.useState(null),i=Xt(n);return!n&&!r&&i&&a(i),Te(()=>{if(!o)return;const d=r==null?void 0:r.key,c=r==null?void 0:r.props.id;if(d==null||c==null){a(null);return}Promise.resolve(t(c,o)).then(()=>{a(null)})},[t,r,o]),ee.createElement(ee.Fragment,null,n,r?p.cloneElement(r,{ref:l}):null)}const ea={x:0,y:0,scaleX:1,scaleY:1};function ta(e){let{children:t}=e;return ee.createElement(Rt.Provider,{value:Ar},ee.createElement(sn.Provider,{value:ea},t))}const na={position:"fixed",touchAction:"none"},ra=e=>nn(e)?"transform 250ms ease":void 0,sa=p.forwardRef((e,t)=>{let{as:n,activatorEvent:r,adjustScale:a,children:o,className:l,rect:i,style:d,transform:c,transition:h=ra}=e;if(!i)return null;const f=a?c:{...c,scaleX:1,scaleY:1},y={...na,width:i.width,height:i.height,top:i.top,left:i.left,transform:Qe.Transform.toString(f),transformOrigin:a&&r?Js(r,i):void 0,transition:typeof h=="function"?h(r):h,...d};return ee.createElement(n,{className:l,style:y,ref:t},o)}),oa=e=>t=>{let{active:n,dragOverlay:r}=t;const a={},{styles:o,className:l}=e;if(o!=null&&o.active)for(const[i,d]of Object.entries(o.active))d!==void 0&&(a[i]=n.node.style.getPropertyValue(i),n.node.style.setProperty(i,d));if(o!=null&&o.dragOverlay)for(const[i,d]of Object.entries(o.dragOverlay))d!==void 0&&r.node.style.setProperty(i,d);return l!=null&&l.active&&n.node.classList.add(l.active),l!=null&&l.dragOverlay&&r.node.classList.add(l.dragOverlay),function(){for(const[d,c]of Object.entries(a))n.node.style.setProperty(d,c);l!=null&&l.active&&n.node.classList.remove(l.active)}},aa=e=>{let{transform:{initial:t,final:n}}=e;return[{transform:Qe.Transform.toString(t)},{transform:Qe.Transform.toString(n)}]},ia={duration:250,easing:"ease",keyframes:aa,sideEffects:oa({styles:{active:{opacity:"0"}}})};function la(e){let{config:t,draggableNodes:n,droppableContainers:r,measuringConfiguration:a}=e;return tn((o,l)=>{if(t===null)return;const i=n.get(o);if(!i)return;const d=i.node.current;if(!d)return;const c=Rr(l);if(!c)return;const{transform:h}=we(l).getComputedStyle(l),f=br(h);if(!f)return;const y=typeof t=="function"?t:ca(t);return jr(d,a.draggable.measure),y({active:{id:o,data:i.data,node:d,rect:a.draggable.measure(d)},draggableNodes:n,dragOverlay:{node:l,rect:a.dragOverlay.measure(c)},droppableContainers:r,measuringConfiguration:a,transform:f})})}function ca(e){const{duration:t,easing:n,sideEffects:r,keyframes:a}={...ia,...e};return o=>{let{active:l,dragOverlay:i,transform:d,...c}=o;if(!t)return;const h={x:i.rect.left-l.rect.left,y:i.rect.top-l.rect.top},f={scaleX:d.scaleX!==1?l.rect.width*d.scaleX/i.rect.width:1,scaleY:d.scaleY!==1?l.rect.height*d.scaleY/i.rect.height:1},y={x:d.x-h.x,y:d.y-h.y,...f},v=a({...c,active:l,dragOverlay:i,transform:{initial:d,final:y}}),[I]=v,w=v[v.length-1];if(JSON.stringify(I)===JSON.stringify(w))return;const _=r==null?void 0:r({active:l,dragOverlay:i,...c}),R=i.node.animate(v,{duration:t,easing:n,fill:"forwards"});return new Promise(D=>{R.onfinish=()=>{_==null||_(),D()}})}}let nr=0;function da(e){return p.useMemo(()=>{if(e!=null)return nr++,nr},[e])}const ua=ee.memo(e=>{let{adjustScale:t=!1,children:n,dropAnimation:r,style:a,transition:o,modifiers:l,wrapperElement:i="div",className:d,zIndex:c=999}=e;const{activatorEvent:h,active:f,activeNodeRect:y,containerNodeRect:v,draggableNodes:I,droppableContainers:w,dragOverlay:_,over:R,measuringConfiguration:D,scrollableAncestors:M,scrollableAncestorRects:N,windowRect:O}=Or(),L=p.useContext(sn),C=da(f==null?void 0:f.id),S=$r(l,{activatorEvent:h,active:f,activeNodeRect:y,containerNodeRect:v,draggingNodeRect:_.rect,over:R,overlayNodeRect:_.rect,scrollableAncestors:M,scrollableAncestorRects:N,transform:L,windowRect:O}),A=Ln(y),q=la({config:r,draggableNodes:I,droppableContainers:w,measuringConfiguration:D}),E=A?_.setRef:void 0;return ee.createElement(ta,null,ee.createElement(Qo,{animation:q},f&&C?ee.createElement(sa,{key:C,id:f.id,ref:E,as:i,activatorEvent:h,adjustScale:t,className:d,transition:o,rect:A,style:{zIndex:c,...a},transform:S},n):null))});function Qt(e,t,n){const r=e.slice();return r.splice(n<0?r.length+n:n,0,r.splice(t,1)[0]),r}function fa(e,t){return e.reduce((n,r,a)=>{const o=t.get(r);return o&&(n[a]=o),n},Array(e.length))}function Pt(e){return e!==null&&e>=0}function ha(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function pa(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const qt={scaleX:1,scaleY:1},ma=e=>{var t;let{rects:n,activeNodeRect:r,activeIndex:a,overIndex:o,index:l}=e;const i=(t=n[a])!=null?t:r;if(!i)return null;const d=ga(n,l,a);if(l===a){const c=n[o];return c?{x:a<o?c.left+c.width-(i.left+i.width):c.left-i.left,y:0,...qt}:null}return l>a&&l<=o?{x:-i.width-d,y:0,...qt}:l<a&&l>=o?{x:i.width+d,y:0,...qt}:{x:0,y:0,...qt}};function ga(e,t,n){const r=e[t],a=e[t-1],o=e[t+1];return!r||!a&&!o?0:n<t?a?r.left-(a.left+a.width):o.left-(r.left+r.width):o?o.left-(r.left+r.width):r.left-(a.left+a.width)}const Lr=e=>{let{rects:t,activeIndex:n,overIndex:r,index:a}=e;const o=Qt(t,r,n),l=t[a],i=o[a];return!i||!l?null:{x:i.left-l.left,y:i.top-l.top,scaleX:i.width/l.width,scaleY:i.height/l.height}},Bt={scaleX:1,scaleY:1},En=e=>{var t;let{activeIndex:n,activeNodeRect:r,index:a,rects:o,overIndex:l}=e;const i=(t=o[n])!=null?t:r;if(!i)return null;if(a===n){const c=o[l];return c?{x:0,y:n<l?c.top+c.height-(i.top+i.height):c.top-i.top,...Bt}:null}const d=ba(o,a,n);return a>n&&a<=l?{x:0,y:-i.height-d,...Bt}:a<n&&a>=l?{x:0,y:i.height+d,...Bt}:{x:0,y:0,...Bt}};function ba(e,t,n){const r=e[t],a=e[t-1],o=e[t+1];return r?n<t?a?r.top-(a.top+a.height):o?o.top-(r.top+r.height):0:o?o.top-(r.top+r.height):a?r.top-(a.top+a.height):0:0}const zr="Sortable",Pr=ee.createContext({activeIndex:-1,containerId:zr,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:Lr,disabled:{draggable:!1,droppable:!1}});function Yt(e){let{children:t,id:n,items:r,strategy:a=Lr,disabled:o=!1}=e;const{active:l,dragOverlay:i,droppableRects:d,over:c,measureDroppableContainers:h}=Or(),f=It(zr,n),y=i.rect!==null,v=p.useMemo(()=>r.map(L=>typeof L=="object"&&"id"in L?L.id:L),[r]),I=l!=null,w=l?v.indexOf(l.id):-1,_=c?v.indexOf(c.id):-1,R=p.useRef(v),D=!ha(v,R.current),M=_!==-1&&w===-1||D,N=pa(o);Te(()=>{D&&I&&h(v)},[D,v,I,h]),p.useEffect(()=>{R.current=v},[v]);const O=p.useMemo(()=>({activeIndex:w,containerId:f,disabled:N,disableTransforms:M,items:v,overIndex:_,useDragOverlay:y,sortedRects:fa(v,d),strategy:a}),[w,f,N.draggable,N.droppable,M,v,_,d,y,a]);return ee.createElement(Pr.Provider,{value:O},t)}const xa=e=>{let{id:t,items:n,activeIndex:r,overIndex:a}=e;return Qt(n,r,a).indexOf(t)},va=e=>{let{containerId:t,isSorting:n,wasDragging:r,index:a,items:o,newIndex:l,previousItems:i,previousContainerId:d,transition:c}=e;return!c||!r||i!==o&&a===l?!1:n?!0:l!==a&&t===d},ya={duration:200,easing:"ease"},qr="transform",wa=Qe.Transition.toString({property:qr,duration:0,easing:"linear"}),_a={roleDescription:"sortable"};function Na(e){let{disabled:t,index:n,node:r,rect:a}=e;const[o,l]=p.useState(null),i=p.useRef(n);return Te(()=>{if(!t&&n!==i.current&&r.current){const d=a.current;if(d){const c=mt(r.current,{ignoreTransform:!0}),h={x:d.left-c.left,y:d.top-c.top,scaleX:d.width/c.width,scaleY:d.height/c.height};(h.x||h.y)&&l(h)}}n!==i.current&&(i.current=n)},[t,n,r,a]),p.useEffect(()=>{o&&l(null)},[o]),o}function ja(e){let{animateLayoutChanges:t=va,attributes:n,disabled:r,data:a,getNewIndex:o=xa,id:l,strategy:i,resizeObserverConfig:d,transition:c=ya}=e;const{items:h,containerId:f,activeIndex:y,disabled:v,disableTransforms:I,sortedRects:w,overIndex:_,useDragOverlay:R,strategy:D}=p.useContext(Pr),M=Ca(r,v),N=h.indexOf(l),O=p.useMemo(()=>({sortable:{containerId:f,index:N,items:h},...a}),[f,a,N,h]),L=p.useMemo(()=>h.slice(h.indexOf(l)),[h,l]),{rect:C,node:S,isOver:A,setNodeRef:q}=zn({id:l,data:O,disabled:M.droppable,resizeObserverConfig:{updateMeasurementsFor:L,...d}}),{active:E,activatorEvent:U,activeNodeRect:g,attributes:j,setNodeRef:B,listeners:G,isDragging:T,over:Q,setActivatorNodeRef:Z,transform:Fe}=Mr({id:l,data:O,attributes:{..._a,...n},disabled:M.draggable}),Me=Ts(q,B),ie=!!E,ne=ie&&!I&&Pt(y)&&Pt(_),le=!R&&T,Ue=le&&ne?Fe:null,at=ne?Ue??(i??D)({rects:w,activeNodeRect:g,activeIndex:y,overIndex:_,index:N}):null,Se=Pt(y)&&Pt(_)?o({id:l,items:h,activeIndex:y,overIndex:_}):N,Ee=E==null?void 0:E.id,J=p.useRef({activeId:Ee,items:h,newIndex:Se,containerId:f}),et=h!==J.current.items,be=t({active:E,containerId:f,isDragging:T,isSorting:ie,id:l,index:N,items:h,newIndex:J.current.newIndex,previousItems:J.current.items,previousContainerId:J.current.containerId,transition:c,wasDragging:J.current.activeId!=null}),We=Na({disabled:!be,index:N,node:S,rect:C});return p.useEffect(()=>{ie&&J.current.newIndex!==Se&&(J.current.newIndex=Se),f!==J.current.containerId&&(J.current.containerId=f),h!==J.current.items&&(J.current.items=h)},[ie,Se,f,h]),p.useEffect(()=>{if(Ee===J.current.activeId)return;if(Ee!=null&&J.current.activeId==null){J.current.activeId=Ee;return}const ze=setTimeout(()=>{J.current.activeId=Ee},50);return()=>clearTimeout(ze)},[Ee]),{active:E,activeIndex:y,attributes:j,data:O,rect:C,index:N,newIndex:Se,items:h,isOver:A,isSorting:ie,isDragging:T,listeners:G,node:S,overIndex:_,over:Q,setNodeRef:Me,setActivatorNodeRef:Z,setDroppableNodeRef:q,setDraggableNodeRef:B,transform:We??at,transition:ke()};function ke(){if(We||et&&J.current.newIndex===N)return wa;if(!(le&&!nn(U)||!c)&&(ie||be))return Qe.Transition.toString({...c,property:qr})}}function Ca(e,t){var n,r;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e==null?void 0:e.draggable)!=null?n:t.draggable,droppable:(r=e==null?void 0:e.droppable)!=null?r:t.droppable}}K.Down,K.Right,K.Up,K.Left;const yn=["turn","round","post","","",""],rr=["action","","act"],Sa=e=>e.map(t=>{const n=[...t.cooldowns],r={...t.usage_counts};t.flat_abilities.forEach(i=>{var f;if(!i.limit||i.limit<=0)return;const d=((f=i.limit_unit)==null?void 0:f.toLowerCase())||"",c=yn.includes(d),h=r[i._id]||0;c&&(h>0&&h<i.limit&&!n.some(v=>v.name===i.name)&&i.cd>0&&n.push({id:`cd_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,name:i.name,val:i.cd,max:i.cd,unit:i.cd_unit||"turn"}),r[i._id]=0)});const a=n.map(i=>{var d;return yn.includes((d=i.unit)==null?void 0:d.toLowerCase())?{...i,val:i.val-1}:i}).filter(i=>i.val>0),o=[],l=[];return t.active_effects.forEach(i=>{var c;const d=(c=i.unit)==null?void 0:c.toLowerCase();yn.includes(d)||d==="round(s)"?i.duration_left>1?o.push({...i,duration_left:i.duration_left-1}):l.push(i):o.push(i)}),l.forEach(i=>{if(i.original_ability_id){const d=t.flat_abilities.find(c=>c._id===i.original_ability_id);d&&d.cd>0&&(a.some(c=>c.name===d.name)||a.push({id:`cd_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,name:d.name,val:d.cd,max:d.cd,unit:d.cd_unit||"turn"}))}}),{...t,battle_stats:{...t.battle_stats},active_effects:o,cooldowns:a,usage_counts:r}}),Ea=(e,t)=>{const n=e.cooldowns.map(o=>{var l;return rr.includes((l=o.unit)==null?void 0:l.toLowerCase())?{...o,val:Math.max(0,o.val-t)}:o}).filter(o=>o.val>0),r=[],a=[];return e.active_effects.forEach(o=>{var i;const l=(i=o.unit)==null?void 0:i.toLowerCase();if(rr.includes(l)){const d=o.duration_left-t;d>0?r.push({...o,duration_left:d}):a.push(o)}else r.push(o)}),a.forEach(o=>{if(o.original_ability_id){const l=e.flat_abilities.find(i=>i._id===o.original_ability_id);l&&l.cd>0&&(n.some(i=>i.name===l.name)||n.push({id:`cd_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,name:l.name,val:l.cd,max:l.cd,unit:l.cd_unit||"turn"}))}}),{...e,cooldowns:n,active_effects:r}},ka=["    "," "," ","   "," "," "," ","  "," "," "," "," Duracell","  ","   ",""," "," ( ?)","  ","  "," ","  ","  ","  "," ",""," ","  (IDDQD)"," Nokia 3310","","  ,  ","Uptime 100%","  "," ","Press F to pay respect"," ","  "," "," !"," ","     "," "," "," "," "," ","  ","   "," "," ","  "," ","   "," ","  ",""," "," ","","Perpetuum Mobile","  ",""],sr=["  ","    ",", ","  ","    "," ..."," ","  ","  ","  ?"," "," ","  ","  ","  ","  "," ","   "," "," "," "," ","...","..."," ","  ","  ","   ","   "," ...","404 Ability Not Found","  "," "," ","  DLC"," Premium ","  "," 9999","  "," ","  "," ","  "," ","  ","Alt + F4 ","Press F to pay respect"," ","  ","  ","  ","  "," "," "," ","  "," ","  ","  ","  !","  "," ","   "," ","  "," "," ","  ","  "," "," ","  ","  ","Windows  (1%)"," "," ","  "," ","  "," "," "," 500"," "," "," ","... 99%"," "," ''"," "," "," "," "," ","   ?","  ","  ",", "," ,  !",",  ",", "," ,  ","  ","!"," ","   ","   ","   "," "," "," "," ,    "," "," "," ",""," ",",  ?","  "," ","","  ","  ","  ","   ","  ","  ","  "," "," "," ","  ","   "],wn={level_0:["  "," ","    "," ","   "," "," "," "," ","  ","  ","  100%","  ","   ","  ","  "," "," ()","  -","  ","  "," ,  "," ","  "," "," ","  ","  "," ","  "],level_5:[""," "," "," ",",   "," ","  "," ","  "," ","  "," ",""," ","  "," ","  ","  ","  "," "," "," "," "," ","  ()","","  "," "," ","   "],level_10:[" ","  "," ","  "," "," "," "," "," ","  ()","  ","  "," "," "," "," ","  "," "," "," "," "," ","   "," "," ","  ","  "," "," ",", "],level_15:["","  "," "," ","  "," "," "," "," "," ","  "," "," "," "," "," "," "," "," ","   "," "," "," ","  "," ","  ","   "," ","  "," "],level_20:[" ","  ","   "," "," "," "," "," "," 1- "," ","   ","  "," "," "," ","  "," ","  "," ","  ","  ","  "," ","  "," "," ",""," "," ","  "],level_25:[" "," "," ","","  ","  "," "," "," ","   ","  - ","   "," "," "," "," ","   ","  "," ","  ","   "," "," "," "," "," ","   ","  "," ","  "],level_30:[" ","  ","","  ","  ","","  "," "," ","  ","  "," "," ","  "," "," "," "," "," ","  "," ","  ","  "," ","  "," "," 2- ",""," ","  "],level_35:["    ","","  ","  "," "," "," "," ","  "," ","","  "," "," "," ","  ","  ","  "," "," "," ","  ","  "," "," "," ","  "," ","  "," "],level_40:["  "," "," "," ","  "," ","- "," "," ","  "," "," ","  "," ",""," ,  ","  ","  ","  ","    ","",",    ","  "," ","  "," "," ","  "," "," "],level_45:["  ",""," ","  ","  "," ","  ","   ","  "," "," ","  ","   ","  ","  "," "," "," ","  "," "," "," "," "," "," "," "," "," ",""," "],level_50:["",""," "," ","  ",""," ","  ","- ","   "," "," ","  "," "," "," ","  "," ","  ","   "," "," ",""," ","   ",""," "," "," ","   "],level_55:["  "," "," ","  ","  "," ","R.I.P. Loading...","  ","Fatal Error","Connection Lost"," 200","  "," ","  "," ","  ","  "," ",""," ","Game Over ()"," ..."," ","","","   "," "," "," "," "],level_60:[" ","","","   ","R.I.P.","","Game Over","  "," ","","","  ","  "," "," ","  ","   ?","  ","  ","  ","",""," "," "," ","   "," ","F","   ","  "]},dt=(e,t)=>{const n=[2,0,1,1,1,2],r=e%100>4&&e%100<20?2:n[e%10<5?e%10:5];return t[r]},on=(e,t)=>{const n=(t==null?void 0:t.toLowerCase())||"turn";return["turn","round","","",""].includes(n)?`${e} ${dt(e,["","",""])}`:["post","",""].includes(n)?`${e} ${dt(e,["","",""])}`:["action","","act","",""].includes(n)?`${e} ${dt(e,["","",""])}`:["scene","",""].includes(n)?`${e} ${dt(e,["","",""])}`:["hour","hours","","",""].includes(n)?`${e} ${dt(e,["","",""])}`:["day","days","","","",""].includes(n)?`${e} ${dt(e,["","",""])}`:`${e} ${n}`},Br=(e,t,n)=>{const r=(n==null?void 0:n.toLowerCase())||"turn";if(["hour","day","week","scene","","",""].includes(r)){const a=Math.floor(Math.random()*sr.length);return sr[a]}return on(t,n)},Ct={crit_mag:{label:" . ",value:-15,stack:null},crit_phys:{label:". . ",value:-20,stack:null},heavy_phys:{label:" . ",value:-15,stack:null},heavy_uniq:{label:" . ",value:-15,stack:null},light_mag:{label:" . ",value:-5,stack:null},light_phys:{label:" . ",value:-5,stack:4,desc:"  ()"},light_uniq:{label:" . ",value:-5,stack:null},mid_mag:{label:" . ",value:-10,stack:null},mid_phys:{label:" . ",value:-10,stack:null},mid_uniq:{label:" . ",value:-10,stack:null}},Da=Object.entries(Ct).map(([e,t])=>({tag:e,label:t.label,value:t.value,stack:t.stack})),or=["dodge","evade","movement","move","defense","block","parry","def","","","","","",""],Ze=(e=[])=>e.map(t=>t.toLowerCase().trim()),Ft=(e,t)=>!e||e.length===0?!1:e.some(n=>t.includes(n)),vt=(e=[])=>e.reduce((t,n)=>t+(Number(n.val)||0),0),_n=(e,t,n)=>{if(!e.medcard||!e.medcard.injuries)return 0;let r=0;const a=`_${t==="unique"?"uniq":t}`,o={};return e.medcard.injuries.forEach(l=>{const i=l.template_id;i.endsWith(a)&&(o[i]=(o[i]||0)+(l.count||1))}),Object.entries(o).forEach(([l,i])=>{const d=n.find(c=>c.tag===l);if(d){const c=Number(d.value),h=Number(d.stack);if(h>0){const f=Math.floor(i/h);r+=f*c}else r+=i*c}}),r},Pn=(e,t,n,r=[])=>{const a=[],o=Ze(t),l=Ze(r),i=o.some(c=>["defense","block","dodge","protection","parry","","","","","def"].includes(c)),d=o.some(c=>["attack","hit","damage","melee","ranged","offense","","","","",""].includes(c));return e.flat_passives&&e.flat_passives.forEach(c=>{const h=(c.trigger||"ALWAYS").toUpperCase();if(h==="ABILITY"||h.includes("ABILITY")){c.trigger_ability_id===n&&a.push({name:c.name,bonus:vt(c.bonuses),type:"passive",tags:[...c.tags||[],"ability_mod"],mech:c.desc_mech});return}if((h==="WEAKNESS/RESISTANCE"||h==="WEAKRES")&&r.length>0){Ft(Ze(c.tags),l)&&a.push({name:c.name,bonus:vt(c.bonuses),type:"passive",tags:[...c.tags||[],"weak_res"],mech:c.desc_mech});return}if(!(h==="ON_HIT"&&!d)&&!(h==="ON_DEFENSE"&&!i)&&Ft(Ze(c.tags),o)){let f="passive";h==="ON_HIT"&&(f="on_hit"),h==="ON_DEFENSE"&&(f="on_defense"),a.push({name:c.name,bonus:vt(c.bonuses),type:"passive",tags:[...c.tags||[],f],mech:c.desc_mech})}}),e.active_effects&&e.active_effects.forEach(c=>{if(Ft(Ze(c.tags),o)){let h="";if(c.original_ability_id){const f=e.flat_abilities.find(y=>y._id===c.original_ability_id);f&&(h=f.desc_mech||"")}a.push({name:c.name,bonus:vt(c.bonuses),type:"effect",tags:c.tags,desc:`Active effect. Duration: ${c.duration_left} ${c.unit}`,mech:h})}}),e.equipment&&e.equipment.wearable&&e.equipment.wearable.forEach(c=>{c.is_equipped&&Ft(Ze(c.tags),o)&&a.push({name:c.name,bonus:vt(c.bonuses),type:"item",tags:c.tags,mech:c.desc_mech,desc:c.desc_lore})}),a},Ia=(e,t,n,r,a=[],o=[],l)=>{let i=0;const d=new Set;return l.forEach(h=>{const f=h.toLowerCase();(f.includes("phys")||f.includes(""))&&d.add("phys"),(f.includes("mag")||f.includes(""))&&d.add("magic"),(f.includes("uniq")||f.includes(""))&&d.add("unique")}),t.bonuses&&t.bonuses.forEach(h=>{const f=Number(h.val)||0,y=(h.stat||"").toLowerCase();if(y==="cleanb"){i+=f;return}if(y){if(y.includes("phys")||y.includes("")){d.add("phys");const v=Number(e.stats.phys)||0;i+=v+_n(e,"phys",r)}if(y.includes("mag")||y.includes("")){d.add("magic");const v=Number(e.stats.magic)||0;i+=v+_n(e,"magic",r)}if(y.includes("uniq")||y.includes("")){d.add("unique");const v=Number(e.stats.unique)||0;i+=v+_n(e,"unique",r)}}i+=f}),n&&n.bonuses&&n.bonuses.forEach(h=>{const f=(h.stat||"").toLowerCase(),y=Number(h.val)||0;let v=!1;(f==="cleanb"||!f||f==="any"||(f.includes("phys")||f.includes(""))&&d.has("phys")||(f.includes("mag")||f.includes(""))&&d.has("magic")||(f.includes("uniq")||f.includes(""))&&d.has("unique"))&&(v=!0),v&&(i+=y)}),Pn(e,l,t.name,o).forEach(h=>{a.includes(h.name)||(i+=h.bonus)}),i},Ra=(e=1)=>e>=5?"3d100":e>=3?"2d100":"1d100",Aa=(e,t,n=Da)=>{const r=(c,h,f,y=[],v=[])=>{var g;const I=t.find(j=>j.instance_id===c||j.id===c);if(!I)return null;let w=(g=I.flat_abilities)==null?void 0:g.find(j=>j._id===h);if(!w&&I.ability_groups)for(const j of I.ability_groups){const B=j.abilities.find(G=>G._id===h||G.id&&G.id===h||G.name===h);if(B){w=B;break}}if(!w)return null;const _=I.equipment.usable.find(j=>j._id===f||j.id&&j.id===f||j.name===f),R=Ze(w.tags),D=Ze((_==null?void 0:_.tags)||[]),M=Array.from(new Set([...R,...D])),N=Ia(I,w,_,n,y,v,M),L=Pn(I,M,w.name,v).filter(j=>!y.includes(j.name)).filter(j=>{var B;return j.type==="passive"?(B=j.tags)==null?void 0:B.some(T=>["ability_mod","on_hit","on_defense"].includes(T)):!0}).map(j=>{const B=j.mech?`(${j.mech})`:"";return`${I.profile.name}: ${j.name}${B}`}),C=N>=0?"+":"",S=_&&_.name?` [${_.name}]`:"",A=`${w.name}${S}`,q=Ra(I.profile.level),E=M.some(j=>["form",""].includes(j.toLowerCase())),U=M.some(j=>["buff",""].includes(j.toLowerCase()));return{name:A,actorName:I.profile.name,bonus:`${C}${N}`,dice:q,isForm:E,isBuff:U,mechanics:w.desc_mech,modifiers:L,tags:M}},a=(c,h)=>{var f,y,v,I,w;if(c.type==="divider")return{text:"__DIVIDER__",tags:[]};if(c.type==="logic_chain")return{text:`
{ ${c.children.map(D=>a(D,h).text).join(" | ")} }`,tags:[]};if(c.type==="condition"){const _=((f=c.data)==null?void 0:f.conditionText)||"...";let D=c.children.map(M=>a(M,h).text).filter(M=>M&&M.trim()!=="").join(" - ");return{text:`${_}: ${D}`,tags:[]}}if(c.type==="combo"){const _=c.children.filter(C=>C.type==="action");if(_.length===0)return{text:"",tags:[]};const R=[];let D=[...h];if(_.forEach(C=>{var A,q,E,U;const S=r(((A=C.data)==null?void 0:A.charId)||"",((q=C.data)==null?void 0:q.abilityId)||"",(E=C.data)==null?void 0:E.weaponId,(U=C.data)==null?void 0:U.excludedModifiers,D);S&&(R.push(S),!S.tags.some(j=>or.includes(j.toLowerCase()))&&S.tags.length>0&&(D=S.tags))}),R.length===0)return{text:"",tags:[]};const M=R.map(C=>`${C.actorName}: ${C.name}`).join(" + "),N=R.map(C=>C.isForm||C.isBuff?"-":`${C.dice}${C.bonus}`).join("/");let O=`[${M}(${N})]`;const L=[];return R.forEach(C=>{C.modifiers&&C.modifiers.length>0&&L.push(...C.modifiers)}),L.length>0&&(O+=` - ${L.join(" - ")}`),{text:O,tags:D}}if(c.type==="action"){const _=r(((y=c.data)==null?void 0:y.charId)||"",((v=c.data)==null?void 0:v.abilityId)||"",(I=c.data)==null?void 0:I.weaponId,(w=c.data)==null?void 0:w.excludedModifiers,h);if(!_)return{text:"[Unknown Action]",tags:[]};let R="";return _.isForm?R=`<${_.actorName}: ${_.name} (${_.mechanics||""})>`:_.isBuff?R=`(${_.actorName}: ${_.name} (${_.mechanics||""}))`:R=`${_.actorName}: ${_.name}(${_.dice}${_.bonus})`,_.modifiers&&_.modifiers.length>0&&(R+=" - "+_.modifiers.join(" - ")),{text:R,tags:_.tags}}return{text:"",tags:[]}};let o=[];const l=[];for(const c of e){const h=a(c,o);h.text&&l.push(h.text),h.tags&&h.tags.length>0&&(h.tags.some(y=>or.includes(y.toLowerCase()))||(o=h.tags)),c.type}let i="",d=!0;return l.forEach(c=>{if(c==="__DIVIDER__")i+=`

`,d=!0;else{const h=c.trim();h&&(d?(i+="> "+h,d=!1):i+=" - "+h)}}),{formattedString:i.trim()}},Nn=(e,t)=>!e||e.length===0?"":e[t%e.length],Fr=e=>[...e].sort((t,n)=>t.id!==n.id?t.id.localeCompare(n.id):t.profile.name.localeCompare(n.profile.name,void 0,{numeric:!0,sensitivity:"base"})),kn=(e=[])=>{const t=e.map(n=>n.toLowerCase().trim());return t.includes("no_war")||t.includes("")},Ur=(e,t)=>{let n="";const r=Fr(e);r.forEach(d=>{const{trauma_phys:c=0,trauma_mag:h=0,trauma_uniq:f=0}=d.battle_stats;let y="";const v=d.instance_id.split("").reduce((R,D)=>R+D.charCodeAt(0),0),I=Math.abs(v+c+t);if(c===0)y=Nn(wn.level_0,I);else{const R=Math.abs(c),D=Math.ceil(R/5)*5,M=D>60?"level_60":`level_${D}`,N=wn[M]||wn.level_60;y=Nn(N,I)}const w=[];c!==0&&w.push(`: ${c}`),h!==0&&w.push(`: ${h}`),f!==0&&w.push(`: ${f}`);const _=w.length>0?`(${w.join(", ")})`:"";n+=`${d.profile.name}  ${y} ${_}

`});const a=[],o=[],l=[];r.forEach(d=>{d.active_effects.forEach(c=>{var w;if(kn(c.tags))return;const h=(c.tags||[]).some(_=>_.toLowerCase().includes("form")||_.toLowerCase().includes("")),f=c.bonuses.some(_=>_.val<0);let y=on(c.duration_left,c.unit);const v=((w=c.unit)==null?void 0:w.toLowerCase())||"";if(c.duration_left>50||["battle","","day",""].includes(v)){const _=c.id.split("").reduce((R,D)=>R+D.charCodeAt(0),0)+t;y=Nn(ka,_)}const I=`${c.name} (${d.profile.name})  ${y}`;h?a.push(I):f?l.push(I):o.push(I)})}),a.length>0&&(n+=` :
`+a.join(`
`)+`

`),o.length>0&&(n+=` :
`+o.join(`
`)+`

`),l.length>0&&(n+=` :
`+l.join(`
`)+`

`),a.length===0&&o.length===0&&l.length===0&&(n+=`(   )

`),n+=`:
`;const i=[];return r.forEach(d=>{d.cooldowns.forEach(c=>{i.push(`${c.name} (${d.profile.name}): ${Br(c.name,c.val,c.unit)}`)})}),i.length>0&&(n+=i.join(`
`)+`
`),n},Wr=e=>Fr(e).map(n=>{const r=[];r.push(`${n.profile.name} (${n.profile.level} .)`);const a=n.battle_stats.trauma_phys,o=n.battle_stats.trauma_mag,l=n.battle_stats.trauma_uniq;r.push(` : ${n.stats.phys}${a!==0?` (${a})`:""}`),r.push(` : ${n.stats.magic}${o!==0?` (${o})`:""}`),r.push(` : ${n.stats.unique}${l!==0?` (${l})`:""}`);const i=n.flat_passives.filter(f=>{const y=(f.trigger||"").toLowerCase().trim();return(!y||y==="always"||y==="passive"||y===""||y===""||y===" / ")&&!kn(f.tags)});i.length>0&&(r.push(">  :"),i.forEach(f=>{r.push(`* ${f.name} (${f.desc_mech||" "})`)}));const d=[],c=[],h=[];return n.active_effects.forEach(f=>{if(kn(f.tags))return;const y=(f.tags||[]).some(w=>w.toLowerCase().includes("form")||w.toLowerCase().includes("")),v=f.bonuses.some(w=>w.val<0),I=`* ${f.name} (. ${on(f.duration_left,f.unit)})`;y?d.push(I):v?h.push(I):c.push(I)}),d.length>0&&(r.push("> :"),d.forEach(f=>r.push(f))),c.length>0&&(r.push("> :"),c.forEach(f=>r.push(f))),h.length>0&&(r.push("> :"),h.forEach(f=>r.push(f))),r.join(`
`)}).join(`


`),Yr=({title:e,desc:t,mech:n,tags:r})=>s.jsxs("div",{className:"absolute left-0 bottom-full mb-2 w-56 bg-black/95 text-white text-[10px] p-2 rounded shadow-glow border border-violet-900/50 opacity-0 group-hover/chip:opacity-100 transition-opacity pointer-events-none z-[9999] backdrop-blur-sm",children:[s.jsx("div",{className:"font-bold mb-1 border-b border-violet-900 pb-1 text-yellow-500 font-rune tracking-wide",children:e}),n&&s.jsx("div",{className:"mb-1 text-cyan-300 font-mono",children:n}),t&&s.jsx("div",{className:"italic text-slate-400 mb-1 leading-tight font-serif",children:t}),r&&r.length>0&&s.jsx("div",{className:"mt-1 text-xs text-slate-500 border-t border-gray-800 pt-1 font-mono uppercase",children:r.join(", ")})]}),Ta=(e,t="default")=>{const n=(e.tags||[]).map(o=>o.toLowerCase()),r=new Set;n.some(o=>o.includes("phys")||o.includes("")||o==="melee"||o==="ranged")&&r.add("phys"),n.some(o=>o.includes("magic")||o.includes("mag")||o.includes("")||o==="spell")&&r.add("mag"),n.some(o=>o.includes("unique")||o.includes("uniq")||o.includes(""))&&r.add("uniq"),(e.bonuses||[]).forEach(o=>{o.stat==="phys"&&r.add("phys"),o.stat==="magic"&&r.add("mag"),o.stat==="unique"&&r.add("uniq")});let a="bg-slate-800 border-slate-600 text-slate-300";if(n.some(o=>o==="form"||o===""))a="bg-yellow-900/30 border-yellow-600/50 text-yellow-100";else if(n.some(o=>o==="buff"||o===""))a="bg-emerald-900/30 border-emerald-600/50 text-emerald-100";else{const o=r.has("phys"),l=r.has("mag"),i=r.has("uniq");o&&l&&i?a="bg-[linear-gradient(135deg,rgba(127,29,29,0.4)_0%,rgba(30,58,138,0.4)_50%,rgba(88,28,135,0.4)_100%)] border-slate-500/50 text-white":o&&l?a="bg-gradient-to-br from-red-900/40 to-blue-900/40 border-purple-500/30 text-white":o&&i?a="bg-gradient-to-br from-red-900/40 to-purple-900/30 border-pink-500/30 text-white":l&&i?a="bg-gradient-to-br from-blue-900/40 to-purple-900/40 border-indigo-500/30 text-white":o?a="bg-red-950/40 border-red-800/40 text-red-100":l?a="bg-blue-950/40 border-blue-800/40 text-blue-100":i&&(a="bg-purple-950/40 border-purple-800/40 text-purple-100")}return t==="cooldown"?`${a} cursor-not-allowed border-opacity-20`:`${a} hover:brightness-125 cursor-grab active:cursor-grabbing shadow-sm border hover:shadow-glow transition-all duration-300`},$a=e=>{const t=(e||"").toLowerCase();return["","light",""].includes(t)?"border-amber-500/40 bg-gradient-to-r from-amber-900/10 to-transparent":["","dark","",""].includes(t)?"border-indigo-500/40 bg-gradient-to-r from-indigo-950/30 to-transparent":["npc","",""].includes(t)?"border-red-900/50 bg-gradient-to-r from-red-950/20 to-transparent":"border-violet-900/30 bg-panel"},Ut=({charId:e,ability:t,variant:n="default",cooldownInfo:r,activeInfo:a,onRemove:o})=>{const{attributes:l,listeners:i,setNodeRef:d,isDragging:c}=Mr({id:`source-${e}-${t._id}`,data:{type:"SOURCE_ABILITY",charId:e,abilityId:t._id},disabled:n==="cooldown"||n==="active"}),h=Ta(t,n),f=n==="cooldown";return s.jsxs("div",{ref:d,...i,...l,className:`
        group/chip relative rounded-sm pl-2 py-1 text-xs mb-1 inline-flex items-center select-none z-10 transition-all font-sans tracking-tight
        ${o?"pr-0 gap-0":"pr-2 gap-1"} 
        ${h}
        ${c?"opacity-0":""}
      `,children:[s.jsxs("div",{className:`flex items-center gap-1 ${f?"opacity-50 grayscale":""}`,children:[s.jsx("span",{children:t.name}),r&&s.jsx("span",{className:"text-[9px] text-red-200 font-bold bg-black/60 px-1 rounded border border-red-500/30 shadow-sm font-mono ml-1",children:Br(r.name,r.val,r.unit)}),a&&s.jsx("span",{className:"text-[9px] text-emerald-200 font-bold bg-black/60 px-1 rounded border border-emerald-500/30 shadow-sm font-mono ml-1",children:on(a.val,a.unit)})]}),o&&s.jsx("button",{type:"button",onClick:y=>{y.stopPropagation(),o()},className:"ml-2 pl-2 pr-2 border-l border-white/20 hover:text-red-300 hover:bg-white/10 transition-colors h-full flex items-center justify-center cursor-pointer pointer-events-auto",title:n==="cooldown"?" ":" ",children:s.jsx(lr,{size:10,strokeWidth:3})}),s.jsx(Yr,{title:t.name,mech:t.desc_mech,desc:t.desc_lore,tags:t.tags})]})},Ma=({item:e,isEquipped:t,onToggle:n})=>s.jsxs("div",{className:"group/chip relative flex items-center justify-between text-xs bg-[#0b0d12] p-1.5 rounded border border-violet-900/20 mb-1 hover:border-violet-500/40 transition-colors",children:[s.jsx("span",{className:t?"text-violet-300 shadow-glow":"text-slate-500",children:e.name}),n&&s.jsx("button",{type:"button",onClick:n,className:`ml-2 px-1.5 py-0.5 rounded-sm text-[9px] uppercase font-bold transition-all font-mono tracking-wider ${t?"bg-violet-600 text-white shadow-glow":"bg-slate-800 text-slate-500 hover:text-slate-300"}`,children:t?"":""}),s.jsx(Yr,{title:e.name,mech:e.desc_mech,desc:e.desc_lore,tags:e.tags})]}),st=({title:e,icon:t,children:n,defaultOpen:r=!1,isEmpty:a,titleColor:o="text-slate-500"})=>{const[l,i]=p.useState(r);return a?null:s.jsxs("div",{className:"border-l border-violet-900/20 ml-1 pl-2 mb-2 hover:border-violet-500/40 transition-colors",children:[s.jsxs("button",{type:"button",onClick:()=>i(!l),className:`flex items-center gap-1 ${o} text-[10px] uppercase font-bold tracking-widest mb-1 hover:text-white transition-all w-full text-left outline-none focus:text-white font-rune`,children:[l?s.jsx(cr,{size:10}):s.jsx(In,{size:10}),t,e]}),l&&s.jsx("div",{className:"pl-1 animate-in slide-in-from-top-1 duration-200",children:n})]})},Oa=({participants:e,onToggleEquip:t,onRemoveParticipant:n,onAddInjury:r,onRemoveInjury:a,onAddDebuff:o,onRemoveEffect:l,onRemoveCooldown:i,onUpdateParticipant:d})=>{const[c,h]=p.useState({}),[f,y]=p.useState(Object.keys(Ct)[0]),[v,I]=p.useState(null),[w,_]=p.useState({name:"",mod:"-5",stat:"phys",tag:"",dur:"2",unit:"turn"}),R=N=>{h(O=>({...O,[N]:!O[N]}))},D=(N=[])=>!N.some(O=>O.toLowerCase()==="no_war"),M=N=>{if(!w.name)return;const O=parseInt(w.mod)||0,L=parseInt(w.dur)||1,C=w.stat;o(N,w.name,C,O,L,w.unit,w.tag),_({...w,name:""})};return s.jsx("div",{className:"flex-1 overflow-y-auto space-y-4 px-1 pb-10 custom-scrollbar",children:e.map(N=>{const O=c[N.instance_id]??!0,L=v===N.instance_id,C=new Set(N.active_effects.map(g=>g.name)),S=new Map;N.cooldowns.forEach(g=>S.set(g.name,g));const A=[],q=[],E=g=>C.has(g)||S.has(g);N.active_effects.forEach(g=>{const j=N.flat_abilities.find(Q=>Q.name===g.name),B=(j==null?void 0:j.desc_mech)||`Effect: ${g.name}`,G=(j==null?void 0:j.desc_lore)||"",T=j||{_id:g.id,name:g.name,tags:g.tags||[],bonuses:g.bonuses,cd:0,cd_unit:"",dur:0,dur_unit:"",desc_mech:B,desc_lore:G};A.push({ability:T,effect:g})}),N.cooldowns.forEach(g=>{const j=N.flat_abilities.find(Q=>Q.name===g.name),B=(j==null?void 0:j.desc_mech)||"On Cooldown",G=(j==null?void 0:j.desc_lore)||"",T=j||{_id:g.id,name:g.name,tags:[],bonuses:[],cd:0,cd_unit:"",dur:0,dur_unit:"",desc_mech:B,desc_lore:G};q.push({ability:T,cooldown:g})});const U=$a(N.profile.faction);return s.jsxs("div",{className:`rounded border shadow-md overflow-hidden transition-all duration-300 hover:shadow-glow ${U}`,children:[s.jsxs("div",{className:`p-2 flex items-center justify-between cursor-pointer hover:bg-white/5 transition-all ${O?"bg-black/20":""}`,onClick:()=>R(N.instance_id),children:[s.jsxs("div",{className:"flex items-center gap-2",children:[O?s.jsx(cr,{size:14,className:"text-violet-400"}):s.jsx(In,{size:14,className:"text-slate-500"}),s.jsx(Hr,{size:14,className:"text-violet-500"}),s.jsxs("span",{className:"font-bold text-sm text-slate-200 font-rune tracking-wide",children:[N.profile.name," ",s.jsxs("span",{className:"text-xs text-slate-500 font-mono tracking-normal opacity-70",children:[N.profile.level," ."]})]})]}),s.jsx("div",{className:"flex items-center gap-3",children:s.jsx("button",{type:"button",onClick:g=>{g.stopPropagation(),n(N.instance_id)},className:"text-slate-600 hover:text-red-500 transition-colors",children:s.jsx(qe,{size:12})})})]}),O&&s.jsxs("div",{className:"p-2 space-y-1 bg-black/10",children:[s.jsx("div",{className:"flex justify-end mb-2",children:L?s.jsxs("button",{onClick:()=>I(null),className:"flex items-center gap-1 text-[10px] bg-emerald-900/30 text-emerald-400 px-2 py-1 rounded border border-emerald-500/30 hover:bg-emerald-800/50",children:[s.jsx(Rn,{size:10})," "]}):s.jsxs("button",{onClick:()=>I(N.instance_id),className:"flex items-center gap-1 text-[10px] bg-slate-900/50 text-slate-400 px-2 py-1 rounded border border-slate-700 hover:text-white",children:[s.jsx(os,{size:10})," ."]})}),L&&d&&s.jsxs("div",{className:"bg-[#0b0d12] p-2 rounded border border-violet-900/30 mb-2 space-y-2",children:[s.jsx("input",{className:"w-full bg-slate-900 border border-slate-700 rounded px-2 py-1 text-xs text-white",value:N.profile.name,onChange:g=>d(N.instance_id,{profile:{...N.profile,name:g.target.value}}),placeholder:""}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("div",{className:"flex-1 flex items-center gap-1 bg-red-900/10 p-1 rounded border border-red-900/20",children:[s.jsx(ir,{size:10,className:"text-red-500"}),s.jsx("input",{type:"number",className:"w-full bg-transparent text-xs text-center text-red-200 outline-none",value:N.stats.phys,onChange:g=>d(N.instance_id,{stats:{...N.stats,phys:parseInt(g.target.value)}})})]}),s.jsxs("div",{className:"flex-1 flex items-center gap-1 bg-blue-900/10 p-1 rounded border border-blue-900/20",children:[s.jsx(Kr,{size:10,className:"text-blue-500"}),s.jsx("input",{type:"number",className:"w-full bg-transparent text-xs text-center text-blue-200 outline-none",value:N.stats.magic,onChange:g=>d(N.instance_id,{stats:{...N.stats,magic:parseInt(g.target.value)}})})]}),s.jsxs("div",{className:"flex-1 flex items-center gap-1 bg-purple-900/10 p-1 rounded border border-purple-900/20",children:[s.jsx(Gr,{size:10,className:"text-purple-500"}),s.jsx("input",{type:"number",className:"w-full bg-transparent text-xs text-center text-purple-200 outline-none",value:N.stats.unique,onChange:g=>d(N.instance_id,{stats:{...N.stats,unique:parseInt(g.target.value)}})})]})]})]}),s.jsx(st,{title:"",icon:s.jsx(_s,{size:10}),defaultOpen:!1,titleColor:"text-red-400",children:s.jsxs("div",{className:"flex flex-col gap-2 bg-[#0b0d12]/50 p-2 rounded border border-red-900/20",children:[N.medcard.injuries.length>0?s.jsx("div",{className:"space-y-1",children:N.medcard.injuries.map((g,j)=>{const B=Ct[g.template_id];return s.jsxs("div",{className:"flex justify-between items-center bg-red-900/10 px-2 py-1 rounded border border-red-900/30",children:[s.jsxs("span",{className:"text-[10px] text-red-200 font-mono",children:[B?B.label:g.template_id," ",g.count>1?`(x${g.count})`:""]}),s.jsx("button",{onClick:()=>a(N.instance_id,j),className:"text-red-500 hover:text-red-300",children:s.jsx(qe,{size:10})})]},j)})}):s.jsx("div",{className:"text-[10px] text-slate-600 italic font-mono",children:"  "}),s.jsxs("div",{className:"flex gap-1 mt-1 border-t border-violet-900/20 pt-2",children:[s.jsx("select",{className:"flex-1 bg-[#0b0d12] text-[10px] text-white border border-violet-900/30 rounded px-1 outline-none focus:border-red-500",value:f,onChange:g=>y(g.target.value),children:Object.entries(Ct).map(([g,j])=>s.jsxs("option",{value:g,className:"bg-[#0b0d12] text-white",children:[j.label," (",j.value,")"]},g))}),s.jsx("button",{onClick:()=>r(N.instance_id,f),className:"px-2 py-1 bg-red-900/40 hover:bg-red-800 text-red-100 rounded border border-red-700/50 text-[10px]",children:s.jsx(ps,{size:12})})]})]})}),s.jsx(st,{title:" ",icon:s.jsx(Zr,{size:10}),defaultOpen:!1,titleColor:"text-fuchsia-400",children:s.jsx("div",{className:"bg-[#0b0d12]/50 p-2 rounded border border-fuchsia-900/20 space-y-2",children:s.jsxs("div",{className:"flex flex-col gap-1",children:[s.jsx("input",{type:"text",placeholder:" ...",className:"text-[10px] bg-[#0b0d12] border border-violet-900/30 rounded px-1 py-1 text-white placeholder-slate-600 focus:border-fuchsia-500 outline-none",value:w.name,onChange:g=>_({...w,name:g.target.value})}),s.jsx("input",{type:"text",placeholder:".  (. )",className:"text-[10px] bg-[#0b0d12] border border-violet-900/30 rounded px-1 py-1 text-white placeholder-slate-600 focus:border-fuchsia-500 outline-none",value:w.tag,onChange:g=>_({...w,tag:g.target.value})}),s.jsxs("div",{className:"flex gap-1 items-center",children:[s.jsx("input",{type:"number",className:"w-12 text-[10px] bg-[#0b0d12] border border-violet-900/30 rounded px-1 py-1 text-white text-center",value:w.mod,onChange:g=>_({...w,mod:g.target.value})}),s.jsxs("select",{className:"w-16 text-[10px] bg-[#0b0d12] border border-violet-900/30 rounded px-1 py-1 text-white",value:w.stat,onChange:g=>_({...w,stat:g.target.value}),children:[s.jsx("option",{value:"phys",className:"bg-[#0b0d12]",children:""}),s.jsx("option",{value:"mag",className:"bg-[#0b0d12]",children:""}),s.jsx("option",{value:"uniq",className:"bg-[#0b0d12]",children:""}),s.jsx("option",{value:"none",className:"bg-[#0b0d12]",children:""})]}),s.jsx("input",{type:"number",className:"w-10 text-[10px] bg-[#0b0d12] border border-violet-900/30 rounded px-1 py-1 text-white text-center",value:w.dur,onChange:g=>_({...w,dur:g.target.value})}),s.jsxs("select",{className:"flex-1 text-[10px] bg-[#0b0d12] border border-violet-900/30 rounded px-1 py-1 text-white",value:w.unit,onChange:g=>_({...w,unit:g.target.value}),children:[s.jsx("option",{value:"turn",className:"bg-[#0b0d12]",children:""}),s.jsx("option",{value:"action",className:"bg-[#0b0d12]",children:""}),s.jsx("option",{value:"scene",className:"bg-[#0b0d12]",children:""})]})]}),s.jsx("button",{onClick:()=>M(N.instance_id),className:"w-full text-[10px] uppercase font-bold bg-fuchsia-900/20 hover:bg-fuchsia-800/40 text-fuchsia-300 border border-fuchsia-800/30 rounded py-1 transition-colors tracking-wider",children:""})]})})}),s.jsx(st,{title:" ",icon:s.jsx(Vr,{size:10}),defaultOpen:!0,isEmpty:A.length===0,titleColor:"text-emerald-400",children:s.jsx("div",{className:"flex flex-wrap",children:A.map(({ability:g,effect:j})=>s.jsx(Ut,{charId:N.instance_id,ability:g,variant:"active",activeInfo:{val:j.duration_left,unit:j.unit},onRemove:l?()=>l(N.instance_id,j.id):void 0},`active-${g._id}`))})}),s.jsx(st,{title:"",icon:s.jsx(Qr,{size:10}),defaultOpen:!0,isEmpty:q.length===0,titleColor:"text-slate-400",children:s.jsx("div",{className:"flex flex-wrap",children:q.map(({ability:g,cooldown:j})=>s.jsx(Ut,{charId:N.instance_id,ability:g,variant:"cooldown",cooldownInfo:j,onRemove:i?()=>i(N.instance_id,j.id):void 0},`cd-${g._id}`))})}),N.ability_groups.map(g=>{const j=(g.abilities||[]).filter(B=>!E(B.name)&&D(B.tags));return j.length===0?null:s.jsx(st,{title:g.name,icon:s.jsx(js,{size:10}),children:s.jsx("div",{className:"flex flex-wrap",children:j.map(B=>s.jsx(Ut,{charId:N.instance_id,ability:B},B._id))})},g.name)}),s.jsx(st,{title:"",icon:s.jsx(es,{size:10}),isEmpty:N.equipment.usable.length===0,children:s.jsx("div",{className:"flex flex-wrap",children:N.equipment.usable.filter(g=>D(g.tags)).map(g=>s.jsx(Ut,{charId:N.instance_id,ability:g},g._id))})}),s.jsx(st,{title:"",icon:s.jsx(as,{size:10}),defaultOpen:!1,isEmpty:N.equipment.wearable.length===0,children:s.jsx("div",{className:"flex flex-col gap-1",children:N.equipment.wearable.map(g=>s.jsx(Ma,{item:g,isEquipped:g.is_equipped,onToggle:()=>t(N.instance_id,g._id)},g._id))})})]})]},N.instance_id)})})},ar=({title:e,desc:t,mech:n,tags:r})=>s.jsxs("div",{className:"absolute left-0 bottom-full mb-2 w-64 bg-[#050b14]/95 text-white text-[10px] p-2 rounded shadow-glow border border-violet-900/50 opacity-0 group-hover/mod:opacity-100 transition-opacity pointer-events-none z-[9999] backdrop-blur-sm",children:[s.jsx("div",{className:"font-bold mb-1 border-b border-violet-900 pb-1 text-yellow-500 font-rune tracking-wide",children:e}),n&&s.jsx("div",{className:"mb-1 text-cyan-300 font-mono text-xs",children:n}),t&&s.jsx("div",{className:"italic text-slate-400 mb-1 leading-tight font-serif",children:t}),r&&r.length>0&&s.jsx("div",{className:"mt-1 text-xs text-slate-500 border-t border-gray-800 pt-1 font-mono uppercase",children:r.join(", ")})]}),La=e=>{const t=(e.tags||[]).map(o=>o.toLowerCase()),n=new Set;t.some(o=>o.includes("phys")||o.includes("")||o==="melee"||o==="ranged")&&n.add("phys"),t.some(o=>o.includes("magic")||o.includes("mag")||o.includes("")||o==="spell")&&n.add("mag"),t.some(o=>o.includes("unique")||o.includes("uniq")||o.includes(""))&&n.add("uniq"),(e.bonuses||[]).forEach(o=>{o.stat==="phys"&&n.add("phys"),o.stat==="magic"&&n.add("mag"),o.stat==="unique"&&n.add("uniq")});let r="bg-panel border-slate-700/50";if(t.some(o=>o==="form"||o===""))r="bg-yellow-900/20 border-yellow-600/40 text-yellow-100";else if(t.some(o=>o==="buff"||o===""))r="bg-emerald-900/20 border-emerald-600/40 text-emerald-100";else{const o=n.has("phys"),l=n.has("mag"),i=n.has("uniq");o&&l&&i?r="bg-[linear-gradient(135deg,rgba(127,29,29,0.3)_0%,rgba(30,58,138,0.3)_50%,rgba(88,28,135,0.3)_100%)] border-slate-500/40 text-white":o&&l?r="bg-gradient-to-br from-red-900/30 to-blue-900/30 border-purple-500/30 text-white":o&&i?r="bg-gradient-to-br from-red-900/30 to-purple-900/30 border-pink-500/30 text-white":l&&i?r="bg-gradient-to-br from-blue-900/30 to-purple-900/30 border-indigo-500/30 text-white":o?r="bg-red-950/30 border-red-800/30 text-red-100":l?r="bg-blue-950/30 border-blue-800/30 text-blue-100":i&&(r="bg-purple-950/30 border-purple-800/30 text-purple-100")}return e.bonuses.some(o=>o.val<0)&&!t.some(o=>o==="form"||o==="")&&(r="bg-rose-950/30 border-rose-800/40 text-rose-100"),r},Ht=({node:e,participants:t,onRemove:n,onUpdateData:r,isInsideHorizontalContainer:a,index:o,onAddBranch:l})=>{var M,N,O,L,C,S;const{attributes:i,listeners:d,setNodeRef:c,transform:h,transition:f,isDragging:y}=ja({id:e.id,data:{type:"NODE",node:e}}),[v,I]=p.useState(!1),w=e.type==="combo"&&e.children.length>=2,{setNodeRef:_,isOver:R}=zn({id:`container-${e.id}`,data:{type:"CONTAINER",nodeId:e.id,nodeType:e.type},disabled:e.type==="action"||e.type==="divider"||w}),D={transform:Qe.Translate.toString(h),transition:f,opacity:y?.4:1,zIndex:y?999:1};if(e.type==="logic_chain")return s.jsx("div",{ref:c,style:D,className:"shrink-0 w-full mb-3",children:s.jsxs("div",{className:`
                    bg-panel/90 border border-amber-700/50 rounded-lg overflow-hidden shadow-lg flex flex-col transition-all
                    ${R?"ring-2 ring-amber-500 shadow-glow-gold":""}
                 `,children:[s.jsxs("div",{className:"bg-amber-900/20 p-2 border-b border-amber-800/50 flex items-center justify-between shrink-0",children:[s.jsxs("div",{className:"flex items-center gap-2 text-amber-500 font-bold text-xs uppercase font-rune tracking-wider",children:[s.jsx("div",{...i,...d,className:"cursor-grab hover:text-white",children:s.jsx(fr,{size:14})})," "]}),s.jsx("button",{onClick:()=>n(e.id),className:"text-slate-600 hover:text-red-400",children:s.jsx(qe,{size:12})})]}),s.jsx("div",{ref:_,className:"flex flex-col gap-1 p-2",children:s.jsx(Yt,{items:e.children.map(A=>A.id),strategy:En,children:e.children.map((A,q)=>s.jsx(Ht,{node:A,participants:t,onRemove:n,onUpdateData:r,index:q},A.id))})}),s.jsx("div",{className:"p-2 border-t border-amber-800/30 bg-amber-900/10 text-center",children:l&&s.jsx("button",{onClick:()=>{var A;return l(((A=e.children[e.children.length-1])==null?void 0:A.id)||e.id)},className:"text-[10px] bg-amber-900/30 text-amber-400 px-3 py-1 rounded hover:bg-amber-800/50 border border-amber-800/40 uppercase font-bold tracking-wider w-full font-rune",children:"+  "})})]})});if(e.type==="divider")return s.jsxs("div",{ref:c,style:D,className:"w-full py-2 flex items-center justify-center group relative mb-2",children:[s.jsx("div",{...i,...d,className:"absolute left-0 top-1/2 -translate-y-1/2 p-2 cursor-grab text-slate-600 hover:text-white z-10",children:s.jsx(zt,{size:14})}),s.jsx("div",{className:"w-full h-[1px] bg-gradient-to-r from-transparent via-violet-900/50 to-transparent group-hover:via-violet-500 transition-all"}),s.jsx("div",{className:"absolute bg-[#050b14] px-2 text-[10px] uppercase font-bold text-slate-600 border border-slate-800 rounded group-hover:border-violet-500 group-hover:text-violet-400 z-10 font-rune transition-colors",children:""}),s.jsx("button",{onClick:()=>n(e.id),className:"absolute right-0 top-1/2 -translate-y-1/2 p-2 text-slate-600 hover:text-red-400 z-10",children:s.jsx(qe,{size:12})})]});if(e.type==="condition")return s.jsxs("div",{ref:c,style:D,className:"flex items-start gap-2 mb-2 w-full",children:[s.jsxs("div",{className:`flex-1 border border-violet-900/40 rounded bg-slate-900/50 p-2 flex flex-col gap-2 transition-all ${R?"bg-violet-900/20 ring-1 ring-violet-500":""}`,children:[s.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[s.jsx("div",{...i,...d,className:"cursor-grab text-slate-500 hover:text-white",children:s.jsx(zt,{size:14})}),s.jsx("input",{className:"bg-transparent border-b border-slate-700 text-xs text-white w-full outline-none focus:border-violet-500 placeholder-slate-600 font-mono",placeholder:" (.  )...",value:((M=e.data)==null?void 0:M.conditionText)||"",onChange:A=>r(e.id,{conditionText:A.target.value})})]}),s.jsxs("div",{ref:_,className:"min-h-[40px] border border-dashed border-slate-800 rounded p-1 bg-black/20",children:[e.children.length===0&&s.jsx("div",{className:"text-[10px] text-slate-600 text-center py-2",children:"  "}),s.jsx(Yt,{items:e.children.map(A=>A.id),strategy:En,children:e.children.map((A,q)=>s.jsx(Ht,{node:A,participants:t,onRemove:n,onUpdateData:r,index:q},A.id))})]})]}),s.jsx("button",{onClick:()=>n(e.id),className:"mt-2 text-slate-600 hover:text-red-400",children:s.jsx(qe,{size:14})})]});if(e.type==="combo")return s.jsx("div",{ref:c,style:D,className:"mb-3 w-full",children:s.jsxs("div",{className:`border border-blue-900/30 rounded-lg p-2 bg-gradient-to-r from-blue-950/20 to-transparent transition-all ${R?"ring-1 ring-blue-500 bg-blue-900/20":""}`,children:[s.jsxs("div",{className:"flex items-center justify-between mb-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{...i,...d,className:"cursor-grab text-slate-500 hover:text-blue-400",children:s.jsx(zt,{size:14})}),s.jsx("span",{className:"text-[10px] uppercase font-bold text-blue-400 tracking-wider font-rune",children:"-"})]}),s.jsx("button",{onClick:()=>n(e.id),className:"text-slate-600 hover:text-red-400",children:s.jsx(qe,{size:12})})]}),s.jsxs("div",{ref:_,className:"flex gap-2 min-h-[50px] items-center overflow-x-auto pb-1",children:[e.children.length===0&&s.jsx("div",{className:"text-[10px] text-slate-600 italic w-full text-center",children:"  2 "}),s.jsx(Yt,{items:e.children.map(A=>A.id),strategy:ma,children:e.children.map((A,q)=>s.jsx("div",{className:"flex-1 min-w-[150px]",children:s.jsx(Ht,{node:A,participants:t,onRemove:n,onUpdateData:r,isInsideHorizontalContainer:!0,index:q})},A.id))})]})]})});if(e.type==="action"){const A=(N=e.data)==null?void 0:N.charId,q=(O=e.data)==null?void 0:O.abilityId,E=t.find(T=>T.instance_id===A);let U=(L=E==null?void 0:E.flat_abilities)==null?void 0:L.find(T=>T._id===q);if(!U&&(E!=null&&E.ability_groups)&&E.ability_groups.forEach(T=>{const Q=T.abilities.find(Z=>Z._id===q);Q&&(U=Q)}),!U||!E)return s.jsxs("div",{ref:c,style:D,className:"p-2 bg-red-900/20 border border-red-500/50 text-red-300 rounded text-xs",children:["Unknown Action ",s.jsx("button",{onClick:()=>n(e.id),children:"x"})]});const g=La(U),j=Pn(E,U.tags,U.name),B=((C=e.data)==null?void 0:C.excludedModifiers)||[],G=T=>{const Q=B.includes(T)?B.filter(Z=>Z!==T):[...B,T];r(e.id,{excludedModifiers:Q})};return s.jsxs("div",{ref:c,style:D,className:`relative group p-2 rounded border shadow-sm transition-all ${g} ${a?"h-full flex flex-col justify-between":"mb-2"}`,children:[s.jsxs("div",{className:"flex items-start justify-between gap-2",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{...i,...d,className:"cursor-grab opacity-50 hover:opacity-100",children:s.jsx(zt,{size:12})}),s.jsxs("div",{children:[s.jsx("div",{className:"font-bold text-xs leading-tight",children:U.name}),s.jsx("div",{className:"text-[9px] opacity-70",children:E.profile.name})]})]}),s.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[s.jsx("button",{onClick:()=>I(!v),className:`p-0.5 rounded hover:bg-white/10 ${v?"text-white":"text-slate-400"}`,children:s.jsx(ts,{size:12})}),s.jsx("button",{onClick:()=>n(e.id),className:"text-red-400 hover:bg-white/10 rounded p-0.5",children:s.jsx(qe,{size:12})})]})]}),s.jsx("div",{className:"mt-2 text-[9px] flex flex-wrap gap-1",children:U.tags.slice(0,3).map(T=>s.jsx("span",{className:"px-1 bg-black/20 rounded border border-white/10",children:T},T))}),v&&s.jsxs("div",{className:"mt-2 pt-2 border-t border-white/10 text-[10px] space-y-2 animate-in slide-in-from-top-1 bg-black/20 -mx-2 px-2 pb-1 rounded-b",children:[E.equipment.usable.length>0&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(ir,{size:10,className:"text-slate-500 shrink-0"}),s.jsxs("select",{value:((S=e.data)==null?void 0:S.weaponId)||"",onChange:T=>r(e.id,{weaponId:T.target.value}),className:"bg-black/30 border border-white/10 rounded px-1 py-0.5 w-full outline-none text-[9px] text-slate-300",onClick:T=>T.stopPropagation(),onPointerDown:T=>T.stopPropagation(),children:[s.jsx("option",{value:"",children:" "}),E.equipment.usable.map(T=>s.jsx("option",{value:T._id,children:T.name},T._id))]})]}),j.length>0?s.jsxs("div",{className:"space-y-1",children:[s.jsx("div",{className:"font-bold text-slate-500 uppercase tracking-wider text-[8px] mb-1",children:""}),j.map(T=>{const Q=!B.includes(T.name);return s.jsxs("button",{onClick:Z=>{Z.stopPropagation(),G(T.name)},className:`w-full flex items-center justify-between px-1.5 py-1 rounded border transition-all ${Q?"bg-emerald-900/20 border-emerald-500/30 text-emerald-200":"bg-black/20 border-transparent text-slate-600"}`,onPointerDown:Z=>Z.stopPropagation(),children:[s.jsxs("div",{className:"flex items-center gap-1 overflow-hidden",children:[Q?s.jsx(ls,{size:10}):s.jsx(dr,{size:10}),s.jsx("span",{className:`truncate text-[9px] ${!Q&&"line-through opacity-70"}`,children:T.name})]}),s.jsx("span",{className:"font-mono text-[9px]",children:T.bonus>0?`+${T.bonus}`:T.bonus}),s.jsx(ar,{title:T.name,desc:T.desc,mech:T.mech,tags:T.tags})]},T.name)})]}):s.jsx("div",{className:"text-[8px] text-slate-600 italic text-center",children:"  "})]}),s.jsx(ar,{title:U.name,desc:U.desc_lore,mech:U.desc_mech,tags:U.tags})]})}return null},za=({tree:e,participants:t,onRemove:n,onUpdateData:r,onAddCombo:a,onAddCondition:o,onAddDivider:l,onClear:i,onAddLogicSibling:d,onCommit:c})=>{const{setNodeRef:h,isOver:f}=zn({id:"root-canvas",data:{type:"CONTAINER",nodeId:"root"}});return s.jsxs("div",{className:"flex flex-col h-full bg-transparent rounded-lg overflow-hidden border border-violet-900/30 shadow-inner",children:[s.jsxs("div",{className:"p-2 bg-[#020408]/50 border-b border-violet-900/20 flex items-center gap-2 overflow-x-auto shrink-0 backdrop-blur-sm",children:[s.jsxs("button",{onClick:a,className:"flex items-center gap-1 px-2 py-1 bg-blue-900/20 text-blue-400 border border-blue-800/50 rounded hover:bg-blue-900/40 text-[10px] uppercase font-bold tracking-wider transition-all whitespace-nowrap",children:[s.jsx(ds,{size:12})," "]}),s.jsxs("button",{onClick:o,className:"flex items-center gap-1 px-2 py-1 bg-amber-900/20 text-amber-400 border border-amber-800/50 rounded hover:bg-amber-900/40 text-[10px] uppercase font-bold tracking-wider transition-all whitespace-nowrap",children:[s.jsx(fr,{size:12})," "]}),s.jsxs("button",{onClick:l,className:"flex items-center gap-1 px-2 py-1 bg-slate-800 text-slate-400 border border-slate-700 rounded hover:bg-slate-700 text-[10px] uppercase font-bold tracking-wider transition-all whitespace-nowrap",children:[s.jsx(Is,{size:12})," ."]}),s.jsx("div",{className:"h-4 w-px bg-white/10 mx-1"}),s.jsxs("button",{onClick:i,className:"flex items-center gap-1 px-2 py-1 text-red-400 hover:text-red-300 text-[10px] uppercase font-bold tracking-wider transition-all whitespace-nowrap",children:[s.jsx(qe,{size:12})," "]})]}),s.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-3 relative bg-[#020617]/40",children:s.jsxs("div",{ref:h,className:`min-h-full flex flex-col pb-20 transition-colors ${f?"bg-violet-900/5":""}`,children:[e.length===0&&s.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-slate-600 pointer-events-none opacity-50",children:[s.jsx("div",{className:"text-4xl mb-2 font-rune",children:""}),s.jsx("p",{className:"text-xs font-serif italic",children:"  ..."})]}),s.jsx(Yt,{items:e.map(y=>y.id),strategy:En,children:e.map((y,v)=>s.jsx(Ht,{node:y,participants:t,onRemove:n,onUpdateData:r,onAddBranch:d,index:v},y.id))})]})}),s.jsx("div",{className:"p-3 border-t border-violet-900/30 bg-[#020408]/80 backdrop-blur shrink-0",children:s.jsxs("button",{onClick:c,className:"w-full bg-violet-700 hover:bg-violet-600 text-white font-bold py-3 rounded uppercase tracking-[0.2em] font-rune flex items-center justify-center gap-2 shadow-[0_0_20px_rgba(139,92,246,0.3)] transition-all hover:scale-[1.01]",children:[s.jsx(ur,{size:16,fill:"currentColor"})," "]})})]})},Pa=({logs:e,currentRound:t,participants:n,onUpdateLogs:r,onUpdateParticipant:a,onRollback:o})=>{const[l,i]=p.useState("log"),[d,c]=p.useState(t),[h,f]=p.useState(""),[y,v]=p.useState(""),[I,w]=p.useState(""),[_,R]=p.useState(!1);p.useEffect(()=>{c(t)},[t]),p.useEffect(()=>{var U;const S=e.filter(g=>g.round===d&&g.type!=="system").map(g=>g.text_formatted).join(`

`);v(S);const A=e.find(g=>{var j;return g.round===d&&((j=g.details)==null?void 0:j.participants_snapshot)}),E=e.filter(g=>g.round===d).reverse().find(g=>g.summary!==void 0&&g.summary!==null&&g.type!=="system");E?f(E.summary||""):A&&A.summary?f(A.summary):f(d===t?Ur(n,t):"(  )"),_||(d===t?w(Wr(n)):A&&((U=A.details)!=null&&U.stats_snapshot)?w(A.details.stats_snapshot):w("(  )")),R(!1)},[d,e,n,t]);const D=C=>S=>{C(S.target.value),R(!0)},M=()=>{if(!a)return;I.split(/\n\s*\n/).forEach(S=>{const A=S.split(`
`).map(g=>g.trim()).filter(g=>g);if(A.length===0)return;const q=A[0].match(/^(.+)\s\(\d+\s*\.\)$/i),E=q?q[1].trim():A[0].trim(),U=n.find(g=>g.profile.name===E);if(U){const g={...U.stats};A.forEach(j=>{const B=j.toLowerCase(),G=j.match(/:\s*(-?\d+)/);if(G){const T=parseInt(G[1]);isNaN(T)||(B.startsWith("")?g.phys=T:B.startsWith("")?g.magic=T:B.startsWith("")&&(g.unique=T))}}),a(U.instance_id,{stats:g})}})},N=()=>{const C=e.filter(E=>E.round!==d),S=e.filter(E=>E.round===d&&E.type==="system"),A={id:`edited-${d}-${Date.now()}`,round:d,timestamp:new Date().toISOString(),type:"action",text_formatted:y,summary:h},q=[...C,...S];y.trim()&&q.push(A),q.sort((E,U)=>E.round!==U.round?E.round-U.round:0),r(q),l==="stats"&&M(),R(!1)},O=d<t&&e.some(C=>{var S;return C.round===d&&((S=C.details)==null?void 0:S.participants_snapshot)}),L=C=>{const S=C.trim();return S.includes(" ")||S.includes("")?"bg-violet-500 shadow-[0_0_8px_#8b5cf6] h-3 w-1 rounded-full":S.startsWith("> <")?"bg-amber-400 shadow-[0_0_5px_#fbbf24] h-3 w-1 rounded-full":S.startsWith("> (")?"bg-emerald-500 shadow-[0_0_5px_#10b981] h-3 w-1 rounded-full":S.startsWith("> [")?"bg-blue-500 shadow-[0_0_5px_#3b82f6] h-3 w-1 rounded-full":S.startsWith("> {")||S.startsWith("{")||S.includes("Condition:")||S.includes("")?"bg-indigo-500 shadow-[0_0_5px_#6366f1] h-3 w-1 rounded-full":S.startsWith(">")?"bg-red-600 shadow-[0_0_5px_#dc2626] h-3 w-1 rounded-full":"bg-transparent"};return s.jsxs("div",{className:"h-full flex flex-col bg-slate-900/85 backdrop-blur-sm rounded-lg shadow-xl border border-violet-900/30 overflow-hidden",children:[s.jsxs("div",{className:"flex border-b border-violet-900/30 bg-[#020408]/50",children:[s.jsxs("button",{onClick:()=>i("stats"),className:`flex-1 py-2 text-[10px] font-bold uppercase tracking-wider flex items-center justify-center gap-2 transition-all ${l==="stats"?"bg-violet-900/20 text-violet-300 border-b-2 border-violet-500":"text-slate-500 hover:text-white"}`,children:[s.jsx(fs,{size:14})," "]}),s.jsxs("button",{onClick:()=>i("log"),className:`flex-1 py-2 text-[10px] font-bold uppercase tracking-wider flex items-center justify-center gap-2 transition-all ${l==="log"?"bg-violet-900/20 text-violet-300 border-b-2 border-violet-500":"text-slate-500 hover:text-white"}`,children:[s.jsx(ns,{size:14})," "]}),s.jsxs("button",{onClick:()=>i("summary"),className:`flex-1 py-2 text-[10px] font-bold uppercase tracking-wider flex items-center justify-center gap-2 transition-all ${l==="summary"?"bg-violet-900/20 text-violet-300 border-b-2 border-violet-500":"text-slate-500 hover:text-white"}`,children:[s.jsx(Ss,{size:14})," "]})]}),s.jsxs("div",{className:"bg-[#050b14]/50 border-b border-violet-900/20 p-2 flex items-center justify-between text-xs",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("button",{onClick:()=>c(Math.max(0,d-1)),disabled:d<=0,className:"p-1 hover:bg-slate-800 rounded disabled:opacity-30 text-slate-400 hover:text-white",children:s.jsx(Xr,{size:16})}),s.jsx("span",{className:"font-bold text-violet-400 uppercase font-rune tracking-widest",children:d===0?"":` ${d}`}),s.jsx("button",{onClick:()=>c(Math.min(t,d+1)),disabled:d>=t,className:"p-1 hover:bg-slate-800 rounded disabled:opacity-30 text-slate-400 hover:text-white",children:s.jsx(In,{size:16})})]}),s.jsxs("div",{className:"flex items-center gap-2",children:[O&&o&&s.jsxs("button",{onClick:()=>o(d),className:"flex items-center gap-1 bg-red-900/20 hover:bg-red-900/40 text-red-400 border border-red-900/50 rounded px-2 py-1 text-[10px] uppercase font-bold transition-all mr-2",title:"      ",children:[s.jsx(rs,{size:10}),"  ."]}),_&&s.jsxs("button",{onClick:N,className:"flex items-center gap-1 text-emerald-400 hover:text-emerald-300 font-bold animate-pulse uppercase text-[10px] tracking-wider",children:[s.jsx(Rn,{size:12})," "]})]})]}),s.jsxs("div",{className:"flex-1 bg-[#020408]/30 relative overflow-hidden flex flex-col",children:[l==="stats"&&s.jsx("div",{className:"h-full flex flex-col",children:s.jsx("textarea",{className:"flex-1 bg-transparent text-slate-300 p-4 outline-none resize-none font-mono text-xs leading-relaxed selection:bg-violet-900/50",value:I,onChange:D(w),spellCheck:!1,placeholder:" ..."})}),l==="log"&&s.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar relative pl-2",children:s.jsxs("div",{className:"relative min-h-full",children:[s.jsxs("div",{className:"p-4 font-mono text-xs leading-6 whitespace-pre-wrap break-words pointer-events-none w-full border-none",children:[y.split(`
`).map((C,S)=>s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:`absolute -left-3 top-1.5 transition-all duration-300 ${L(C)}`}),s.jsx("span",{className:"opacity-0",children:C||" "})]},S)),s.jsx("span",{className:"opacity-0",children:"."})]}),s.jsx("textarea",{className:"absolute inset-0 w-full h-full bg-transparent text-slate-300 p-4 font-mono text-xs leading-6 whitespace-pre-wrap break-words outline-none resize-none overflow-hidden selection:bg-violet-900/50 placeholder-slate-700",value:y,onChange:D(v),spellCheck:!1,placeholder:"  ..."})]})}),l==="summary"&&s.jsxs("div",{className:"h-full flex flex-col",children:[s.jsxs("div",{className:"p-2 bg-violet-900/10 text-[10px] text-slate-500 uppercase tracking-widest border-b border-violet-900/20 flex justify-between items-center",children:[s.jsxs("span",{children:[" ( ",d,")"]}),s.jsx("button",{onClick:()=>navigator.clipboard.writeText(h),title:"",className:"hover:text-white",children:s.jsx(gs,{size:12})})]}),s.jsx("textarea",{className:"flex-1 bg-transparent text-slate-300 p-4 text-xs font-mono outline-none resize-none selection:bg-emerald-900/50",value:h,onChange:D(f),placeholder:d<t&&!h?"(  )":"   ...",spellCheck:!1})]})]})]})},Je=({isOpen:e,onClose:t,title:n,children:r,footer:a})=>e?s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4 animate-in fade-in duration-200",children:s.jsxs("div",{className:"relative w-full max-w-md group",children:[s.jsx("div",{className:"absolute -inset-[1px] bg-gradient-to-br from-violet-600 via-indigo-900 to-violet-900 opacity-70 group-hover:opacity-100 transition-opacity duration-500 blur-sm",style:{clipPath:"polygon(20px 0, 100% 0, 100% calc(100% - 20px), calc(100% - 20px) 100%, 0 100%, 0 20px)"}}),s.jsxs("div",{className:"relative bg-[#050b14] shadow-2xl overflow-hidden",style:{clipPath:"polygon(20px 0, 100% 0, 100% calc(100% - 20px), calc(100% - 20px) 100%, 0 100%, 0 20px)"},children:[s.jsxs("div",{className:"flex items-center justify-between p-5 border-b border-violet-900/30 bg-gradient-to-r from-violet-950/40 to-transparent",children:[s.jsx("h3",{className:"text-xl font-rune font-bold text-transparent bg-clip-text bg-gradient-to-r from-violet-200 to-fuchsia-200 tracking-widest uppercase",children:n}),s.jsx("button",{onClick:t,className:"text-slate-500 hover:text-violet-400 transition-colors p-1 rounded hover:bg-white/5",children:s.jsx(lr,{size:24})})]}),s.jsx("div",{className:"p-5 text-slate-300 font-sans",children:r}),a&&s.jsx("div",{className:"p-4 border-t border-violet-900/30 bg-[#020408]/50 flex justify-end gap-3",children:a}),s.jsx("div",{className:"absolute top-0 left-0 w-8 h-8 border-t-2 border-l-2 border-violet-500/50 pointer-events-none"}),s.jsx("div",{className:"absolute bottom-0 right-0 w-8 h-8 border-b-2 border-r-2 border-violet-500/50 pointer-events-none"})]})]})}):null,ot=()=>Math.random().toString(36).substr(2,9),Ke=e=>{if(!e)return[];let t=[];return Array.isArray(e.tags)?t=[...e.tags]:typeof e.tags=="string"&&t.push(e.tags),typeof e.tag=="string"&&t.push(e.tag),t.map(n=>n.toLowerCase().trim()).filter(Boolean)},Dn=(e=[])=>{let t={phys:0,mag:0,uniq:0,total:0};const n={};e.forEach(r=>{const a=n[r.template_id]||0;n[r.template_id]=a+(r.count||1)});for(const[r,a]of Object.entries(n)){const o=Ct[r];if(!o)continue;let l=0;o.stack&&o.stack>0?l=Math.floor(a/o.stack)*o.value:l=a*o.value,t.total+=l,r.includes("phys")?t.phys+=l:r.includes("mag")?t.mag+=l:r.includes("uniq")&&(t.uniq+=l)}return t},qa=e=>Array.isArray(e)?e.map(t=>({...t,bonuses:(t.bonuses||[]).map(n=>({stat:(n.stat||"phys").toLowerCase().trim(),val:n.val!==void 0?n.val:n.value!==void 0?n.value:0}))})):[],wt=e=>Array.isArray(e)?qa(e).map(n=>{var r,a;return{...n,desc_lore:n.desc_lore!==void 0?n.desc_lore:((r=n.desc)==null?void 0:r.lore)||"",desc_mech:n.desc_mech!==void 0?n.desc_mech:((a=n.desc)==null?void 0:a.mech)||""}}):[],Ba=e=>Array.isArray(e)?wt(e).map(n=>{var r,a,o,l,i,d;return{...n,limit:n.limit!==void 0?n.limit:((r=n.limits)==null?void 0:r.value)||0,limit_unit:n.limit_unit!==void 0?n.limit_unit:((a=n.limits)==null?void 0:a.unit)||"",cd:n.cd!==void 0?n.cd:((o=n.cooldown)==null?void 0:o.value)||0,cd_unit:n.cd_unit!==void 0?n.cd_unit:((l=n.cooldown)==null?void 0:l.unit)||"",dur:n.dur!==void 0?n.dur:((i=n.duration)==null?void 0:i.value)||0,dur_unit:n.dur_unit!==void 0?n.dur_unit:((d=n.duration)==null?void 0:d.unit)||""}}):[],Fa=e=>{if(!e)return"ALWAYS";const t=e.toUpperCase().trim();return t.includes("START")||t.includes("")?"COMBAT_START":t.includes("HIT")||t.includes("")||t.includes("")?"ON_HIT":t.includes("KILL")||t.includes("")?"ON_KILL":t.includes("DEFENSE")||t.includes("")?"ON_DEFENSE":t.includes("ABILITY")||t.includes("")?"ABILITY":t.includes("ALWAYS")||t.includes("")||t.includes("")?"ALWAYS":t};async function Ua(){const[e,t]=await Promise.all([Be.from("characters").select("*"),Be.from("basic_actions").select("*")]);if(e.error)return{data:[],error:e.error};const n=(t.data||[]).map(a=>({...a,_id:`global_${a.id||ot()}`,tags:Ke(a)}));return{data:e.data.map(a=>{var w,_,R,D,M,N,O,L,C,S,A,q;let o=a.data||a;a.data&&typeof a.data=="object"&&(o={...a.data,id:a.id});const l={id:o.id||ot(),meta:o.meta||{uid:"system",avatar_url:""},profile:o.profile||o.identity||{name:"Unknown",level:1,faction:"None",npc_volume:""},stats:o.stats||{phys:0,magic:0,unique:0},resources:o.resources||[],equipment:{usable:[],wearable:[],inventory:[]},ability_groups:[],passives:[],medcard:o.medcard||o.med_card||{injuries:[],conditions:[]},flat_abilities:[],flat_passives:[]},i=o.tabs||{};let d=((w=i.equipment)==null?void 0:w.wearable)||((_=o.equipment)==null?void 0:_.wearable);l.equipment.wearable=wt(d).map(E=>({...E,_id:ot(),tags:Ke(E)}));let c=((R=i.equipment)==null?void 0:R.weapons)||((D=i.equipment)==null?void 0:D.usable)||((M=o.equipment)==null?void 0:M.weapons)||((N=o.equipment)==null?void 0:N.usable);l.equipment.usable=wt(c).map(E=>({...E,_id:ot(),tags:Ke(E)}));let h=((O=i.equipment)==null?void 0:O.backpack)||((L=i.equipment)==null?void 0:L.inventory)||((C=o.equipment)==null?void 0:C.backpack)||((S=o.equipment)==null?void 0:S.inventory);l.equipment.inventory=wt(h).map(E=>({...E,_id:ot(),tags:Ke(E)}));const f={name:" ",tags:[],abilities:n,is_hidden:!1};l.ability_groups.push(f),n.forEach(E=>l.flat_abilities.push(E)),(i.abilities&&Array.isArray(i.abilities.schools)?i.abilities.schools:Array.isArray(o.ability_groups)?o.ability_groups:[]).forEach(E=>{if(E.name===" ")return;const U=Ke(E),g=Ba(E.abilities).map(j=>{const B=[...new Set([...U,...Ke(j)])],G={...j,_id:ot(),tags:B};return B.includes("no_war")||l.flat_abilities.push(G),G});l.ability_groups.push({...E,abilities:g})});const v=(E,U)=>{E.forEach(g=>{const j=Ke(g),B=g.items||g.abilities||[],G=wt(B).map(T=>{const Q=[...new Set([...j,...Ke(T)])],Z={...T,_id:ot(),tags:Q,trigger:Fa(T.trigger),is_flaw:U,dur:T.dur||0,dur_unit:T.dur_unit||"turn"};return l.flat_passives.push(Z),Z});l.passives.push({group_name:g.group_name||g.name||(U?"Debuffs":"Passives"),is_flaw_group:U,items:G})})};v(((A=i.passives)==null?void 0:A.groups)||o.passives||[],!1),v(((q=i.debuffs)==null?void 0:q.groups)||o.debuffs||[],!0);const I=Dn(l.medcard.injuries);return l.battle_stats={hp_penalty_current:I.total,trauma_phys:I.phys,trauma_mag:I.mag,trauma_uniq:I.uniq,actions_max:4,actions_left:4},l}),error:null}}async function Wa(){const{data:e,error:t}=await Be.from("battles").select("*");return{data:e,error:t}}async function Ya(e){const{data:t,error:n}=await Be.from("battles").insert([{name:e,participants_snapshot:[],sequence_log:[],casualties:[],round:1,status:"startup"}]).select().single();return{data:t,error:n}}async function ut(e,t){const{data:n,error:r}=await Be.from("battles").update(t).eq("id",e);return{data:n,error:r}}async function Ha(e){const{error:t}=await Be.from("battles").delete().eq("id",e);return{error:t}}async function Va(e,t){const{data:n,error:r}=await Be.from("characters").select("data").eq("id",e).single();if(r||!n)return{error:r};const a={...n.data||{},...t},{error:o}=await Be.from("characters").update({data:a}).eq("id",e);return{error:o}}const me="juul_d_local_battles",Za=({isAdmin:e=!1})=>{const[t,n]=p.useState([]),[r,a]=p.useState(0),[o,l]=p.useState("startup"),[i,d]=p.useState(" "),[c,h]=p.useState([]),[f,y]=p.useState(null),[v,I]=p.useState(e?"server":"local"),[w,_]=p.useState([]),[R,D]=p.useState(!1),[M,N]=p.useState([]),[O,L]=p.useState(null),[C,S]=p.useState(""),[A,q]=p.useState(""),[E,U]=p.useState(()=>{}),[g,j]=p.useState(""),[B,G]=p.useState("All"),[T,Q]=p.useState("All"),[Z,Fe]=p.useState(new Set),[Me,ie]=p.useState(null),[ne,le]=p.useState([]),[Ue,ge]=p.useState(null),[at,Se]=p.useState(null),Ee=Vs(Yn(kr,{activationConstraint:{distance:10}}),Yn(Dr,{activationConstraint:{delay:250,tolerance:5}})),J=p.useRef(!1);p.useEffect(()=>{J.current||(J.current=!0,et())},[e]),p.useEffect(()=>{!e&&v==="server"&&I("local")},[e]);const et=async()=>{const{data:u}=await Ua();u&&u.length>0&&N(u),await be()},be=async()=>{let u=[];try{const x=JSON.parse(localStorage.getItem(me)||"[]").map(m=>({id:m.id,name:m.name,status:m.status,source:"local",timestamp:m.timestamp||0}));u=[...u,...x]}catch(b){console.error("Failed to parse local battles",b)}if(e){const{data:b}=await Wa();if(b){const x=b.map(m=>({id:m.id,name:m.name,status:m.status,source:"server",timestamp:new Date(m.created_at).getTime()}));u=[...u,...x]}}_(u)},We=p.useMemo(()=>{const u=new Set;return M.forEach(b=>{b.profile.faction&&b.profile.faction!==""&&u.add(b.profile.faction)}),Array.from(u).sort()},[M]),ke=p.useMemo(()=>{if(!["NPC","",""].includes(B))return[];const b=new Set;return M.forEach(x=>{x.profile.faction===B&&x.profile.npc_volume&&b.add(x.profile.npc_volume)}),Array.from(b).sort()},[M,B]),ze=p.useMemo(()=>{let u=[...M];if(u=u.filter(x=>x.profile.faction!==""),g){const x=g.toLowerCase();u=u.filter(m=>m.profile.name.toLowerCase().includes(x))}return B!=="All"&&(u=u.filter(x=>x.profile.faction===B)),["NPC","",""].includes(B)&&T!=="All"&&(u=u.filter(x=>x.profile.npc_volume===T)),u.sort((x,m)=>x.profile.name.localeCompare(m.profile.name)),u},[M,g,B,T]),te=u=>{q(u),L("ALERT")},re=()=>{L(null),S(""),q(""),j(""),G("All"),Q("All")},gt=u=>u==="active"?"":u==="finished"?"":u==="startup"?"":u,bt=u=>{const b=(u||"").toLowerCase();return["","light",""].includes(b)?"bg-amber-900/10 border-amber-600/50 hover:bg-amber-900/20 text-amber-100":["","dark","",""].includes(b)?"bg-indigo-950/30 border-indigo-500/50 hover:bg-indigo-900/20 text-indigo-100":["npc","",""].includes(b)?"bg-red-950/20 border-red-800/50 hover:bg-red-900/20 text-red-100":"bg-panel border-violet-900/30 hover:border-violet-500/50 text-slate-200"},De=(u,b)=>{n(x=>x.map(m=>m.instance_id!==u?m:b.profile?{...m,profile:{...m.profile,...b.profile}}:b.stats?{...m,stats:{...m.stats,...b.stats}}:{...m,...b}))},it=(u,b)=>{n(x=>x.map(m=>{if(m.instance_id!==u)return m;const k=m.equipment.wearable.map(P=>P._id===b?{...P,is_equipped:!P.is_equipped}:P);return{...m,equipment:{...m.equipment,wearable:k}}}))},lt=u=>{n(b=>{const x=b.filter(F=>F.instance_id!==u),m={},k=F=>F.replace(/ #\d+$/,"");x.forEach((F,H)=>{const X=k(F.profile.name),W=`${F.id}|${X}`;m[W]||(m[W]=[]),m[W].push(H)});const P=[...x];return Object.values(m).forEach(F=>{if(F.length>0){const H=P[F[0]],X=k(H.profile.name),W=H.profile.name.match(/ #\d+$/);(F.length>1||W)&&F.forEach((z,$)=>{const V=`${X} #${$+1}`;P[z].profile.name!==V&&(P[z]={...P[z],profile:{...P[z].profile,name:V}})})}}),P})},At=(u,b)=>{n(x=>x.map(m=>{if(m.instance_id!==u)return m;const k=m.active_effects.find(H=>H.id===b),P=m.active_effects.filter(H=>H.id!==b);let F=[...m.cooldowns];if(k!=null&&k.original_ability_id){const H=m.flat_abilities.find(X=>X._id===k.original_ability_id);H&&H.cd>0&&(F.some(X=>X.name===H.name)||F.push({id:`cd_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,name:H.name,val:H.cd,max:H.cd,unit:H.cd_unit||"turn"}))}return{...m,active_effects:P,cooldowns:F}}))},Tt=(u,b)=>{n(x=>x.map(m=>m.instance_id!==u?m:{...m,cooldowns:m.cooldowns.filter(k=>k.id!==b)}))},an=(u,b)=>{n(x=>x.map(m=>{if(m.instance_id!==u)return m;const k=[...m.medcard.injuries,{count:1,template_id:b,custom_name:""}],P=Dn(k);return{...m,medcard:{...m.medcard,injuries:k},battle_stats:{...m.battle_stats,hp_penalty_current:P.total,trauma_phys:P.phys,trauma_mag:P.mag,trauma_uniq:P.uniq}}}))},ln=(u,b)=>{n(x=>x.map(m=>{if(m.instance_id!==u)return m;const k=[...m.medcard.injuries];k.splice(b,1);const P=Dn(k);return{...m,medcard:{...m.medcard,injuries:k},battle_stats:{...m.battle_stats,hp_penalty_current:P.total,trauma_phys:P.phys,trauma_mag:P.mag,trauma_uniq:P.uniq}}}))},Ye=(u,b,x,m,k,P,F)=>{n(H=>H.map(X=>{if(X.instance_id!==u)return X;const W=[];x&&x!=="none"&&W.push(x),F&&W.push(F.toLowerCase().trim());const z={id:`custom_${Date.now()}`,name:b,tags:W,bonuses:[{val:m,stat:x}],duration_left:k,unit:P||"turn"};return{...X,active_effects:[...X.active_effects,z]}}))},He=async(u,b)=>{D(!0);let x=null;if(b==="server"){const{data:m}=await Be.from("battles").select("*").eq("id",u).single();x=m}else x=JSON.parse(localStorage.getItem(me)||"[]").find(k=>k.id===u);x?(y(x.id),d(x.name||"  "),a(x.round),l(x.status||"startup"),h(x.sequence_log||[]),n(x.participants_snapshot||[]),e&&I(b)):(te("   ( )."),be()),D(!1),L(null)},tt=(u,b,x)=>{x.stopPropagation(),ie({id:u,source:b}),L("CONFIRM_DELETE")},$t=async()=>{if(!Me){L("BATTLE_LIST");return}const{id:u,source:b}=Me;if(b==="server"){const{error:x}=await Ha(u);if(x){te(` : ${x.message}`);return}}else{const m=JSON.parse(localStorage.getItem(me)||"[]").filter(k=>k.id!==u);localStorage.setItem(me,JSON.stringify(m))}_(x=>x.filter(m=>m.id!==u)),f===u?(y(null),d(" "),a(1),l("startup"),h([]),n([]),le([]),te(b==="server"?"   .":"    .")):L("BATTLE_LIST"),ie(null)},Ie=()=>{ie(null),L("BATTLE_LIST")},Mt=()=>{S(""),L("CREATE_BATTLE")},cn=async()=>{const u=C||"  ";D(!0);const b={id:`battle_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,name:u,participants_snapshot:[],sequence_log:[],casualties:[],round:0,status:"startup"};if(v==="server"&&e){const{data:x,error:m}=await Ya(u);if(m){te(`Failed to create battle in DB. Error: ${m.message}`),D(!1);return}x&&(y(x.id),d(x.name))}else{y(b.id),d(b.name);const x=JSON.parse(localStorage.getItem(me)||"[]");x.push(b),localStorage.setItem(me,JSON.stringify(x))}a(0),l("startup"),n([]),h([]),D(!1),re(),be()},dn=async()=>{if(!f){U(()=>async()=>{te(",     '' -> ''."),re()}),L("CONFIRM_SAVE");return}const u={name:i,participants_snapshot:t,sequence_log:c,round:r,status:o,casualties:[]};if(v==="server"&&e){const{error:b}=await ut(f,u);te(b?`   : ${b.message}.`:"     .")}else{const b=JSON.parse(localStorage.getItem(me)||"[]"),x=b.findIndex(m=>m.id===f);x!==-1?b[x]={...b[x],...u}:b.push({id:f,...u}),localStorage.setItem(me,JSON.stringify(b)),te("  .")}be()},xt=async u=>{d(u)},Ot=u=>u.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),un=u=>{const b=u.profile.name,x=t.filter($=>$.id===u.id);let m=b,k=[...t];if(x.length>0){k=k.map(oe=>oe.id===u.id&&oe.profile.name===b?{...oe,profile:{...oe.profile,name:`${b} #1`}}:oe);const $=new RegExp(`^${Ot(b)} #(\\d+)$`),V=k.filter(oe=>oe.id===u.id).map(oe=>{const ct=oe.profile.name.match($);return ct?parseInt(ct[1]):0}),Y=Math.max(0,...V);m=`${b} #${Y+1}`}const P=(u.ability_groups||[]).flatMap($=>$.abilities||[]);let F=u.flat_passives||[];F.length===0&&u.passives&&(F=u.passives.flatMap($=>$.items));const H=[],X=new Set;let W="";F.forEach($=>{if(X.has($._id)||(X.add($._id),!$.trigger))return;const V=$.trigger.toUpperCase();if(V==="COMBAT_START"||V==="START"){const Y=$.desc_mech?` (${$.desc_mech})`:"";W+=`> (${m}: ${$.name}${Y})
`;const oe=$.dur&&$.dur>0;H.push({id:`start_passive_${$._id||Math.random()}_${Date.now()}`,name:$.name,tags:[...$.tags||[],$.is_flaw?"debuff":"buff"],bonuses:$.bonuses||[],duration_left:oe?$.dur:999,unit:oe?$.dur_unit||"turn":"battle",original_ability_id:$._id})}});const z={...u,instance_id:`char_${u.id}_${Date.now()}`,is_player:!1,profile:{...u.profile,name:m},battle_stats:u.battle_stats||{hp_penalty_current:0,trauma_phys:0,trauma_mag:0,trauma_uniq:0,actions_max:4,actions_left:4},active_effects:H,cooldowns:[],usage_counts:{},flat_abilities:P,flat_passives:F};if(n([...k,z]),W){const $=`trigger_add_${z.instance_id}`;h(V=>V.some(Y=>Y.id===$)?V:[...V,{id:$,round:r,timestamp:new Date().toISOString(),type:"action",text_formatted:W.trim()}])}L(null)},Lt=async()=>{const u=Ur(t,r),b=Wr(t),x=JSON.parse(JSON.stringify(t)),m={id:`end_rnd_${r}_${Date.now()}`,round:r,timestamp:new Date().toISOString(),type:"system",text_formatted:r===0?" ":`  ${r}`,summary:u,details:{stats_snapshot:b,participants_snapshot:x}},k=r+1;let P=o;o==="startup"&&(P="active",l("active"));let F=[...t];r!==0&&(F=Sa(t));const H={id:`start_rnd_${k}_${Date.now()}`,round:k,timestamp:new Date().toISOString(),text_formatted:`  ${k}`,type:"round_change"},X=[m,H],W=[...c,...X];if(a(k),n(F),h(W),l(P),f)if(v==="server"&&e)await ut(f,{sequence_log:W,round:k,status:P,participants_snapshot:F});else{const z=JSON.parse(localStorage.getItem(me)||"[]"),$=z.findIndex(Y=>Y.id===f),V={name:i,participants_snapshot:F,sequence_log:W,round:k,status:P};$!==-1&&(z[$]={...z[$],...V}),localStorage.setItem(me,JSON.stringify(z))}},fn=async u=>{const b=c.find(m=>{var k;return m.round===u&&((k=m.details)==null?void 0:k.participants_snapshot)});if(!b){te(" :      .");return}n(b.details.participants_snapshot),a(b.round);const x=c.filter(m=>m.round<=u&&m.id!==b.id);if(h(x),f){const m={round:b.round,participants_snapshot:b.details.participants_snapshot,sequence_log:x,status:"active"};if(v==="server"&&e)await ut(f,m);else{const k=JSON.parse(localStorage.getItem(me)||"[]"),P=k.findIndex(F=>F.id===f);P!==-1&&(k[P]={...k[P],...m},localStorage.setItem(me,JSON.stringify(k)))}}te(` .     ${u}.`)},hn=()=>{const u=new Set;t.forEach(b=>{b.medcard.injuries.length>0&&u.add(b.instance_id)}),Fe(u),L("FINALIZE_BATTLE")},pn=u=>{const b=new Set(Z);b.has(u)?b.delete(u):b.add(u),Fe(b)},ce=async()=>{if(!e){l("finished"),te("  . -       ."),re();return}D(!0);for(const u of t)Z.has(u.instance_id)&&await Va(u.id,{medcard:u.medcard});l("finished"),f&&v==="server"&&await ut(f,{status:"finished"}),D(!1),re(),te(" .        .")},xe=async()=>{if(l("finished"),f)if(v==="server"&&e)await ut(f,{status:"finished"});else{const u=JSON.parse(localStorage.getItem(me)||"[]"),b=u.findIndex(x=>x.id===f);b!==-1&&(u[b].status="finished",localStorage.setItem(me,JSON.stringify(u)))}re()},he=u=>{let b=[];for(const x of u)x.type==="action"&&b.push(x),x.children&&(b=b.concat(he(x.children)));return b},Oe=async()=>{if(ne.length===0){te(" .    .");return}const u=Aa(ne,t),b={id:Date.now().toString(),round:r,timestamp:new Date().toISOString(),text_formatted:u.formattedString||" ",type:"action"};let x=[...t];const m=he(ne),k={},P=[];m.forEach(W=>{var V,Y;const z=(V=W.data)==null?void 0:V.charId,$=(Y=W.data)==null?void 0:Y.abilityId;z&&(k[z]=(k[z]||0)+1),z&&$&&P.push({charId:z,abilityId:$})});const F=[],H=[];m.forEach(W=>{var oe,ct;const z=(oe=W.data)==null?void 0:oe.charId,$=(ct=W.data)==null?void 0:ct.abilityId;if(!z||!$)return;const V=t.find(Xe=>Xe.instance_id===z);if(!V)return;let Y=V.flat_abilities.find(Xe=>Xe._id===$);Y||V.ability_groups.forEach(Xe=>{const ve=Xe.abilities.find(pe=>pe._id===$);ve&&(Y=ve)}),Y&&(Y.dur>0&&(F.push({charId:z,effect:{id:`eff_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,name:Y.name,tags:Y.tags,bonuses:Y.bonuses,duration_left:Y.dur,unit:Y.dur_unit||"turn",original_ability_id:Y._id}}),V.flat_passives.filter(ve=>ve.trigger==="ABILITY"&&ve.trigger_ability_id===Y.name).forEach(ve=>{F.push({charId:z,effect:{id:`eff_linked_${ve._id}_${Date.now()}`,name:ve.name,tags:[...ve.tags||[],ve.is_flaw?"debuff":"buff","linked"],bonuses:ve.bonuses||[],duration_left:Y.dur,unit:Y.dur_unit||"turn",original_ability_id:Y._id}})})),Y.cd>0&&Y.dur===0&&(!Y.limit||Y.limit<=0)&&H.push({charId:z,cooldown:{id:`cd_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,name:Y.name,val:Y.cd,max:Y.cd,unit:Y.cd_unit||"turn"}}))}),x=x.map(W=>{let z=W;k[W.instance_id]&&(z=Ea(W,k[W.instance_id]));const $=P.filter(pe=>pe.charId===W.instance_id),V={...z.usage_counts},Y=[];$.forEach(pe=>{const Ne=z.flat_abilities.find(qn=>qn._id===pe.abilityId);if(Ne){const Bn=(V[Ne._id]||0)+1;V[Ne._id]=Bn,Ne.limit&&Ne.limit>0&&Bn>=Ne.limit&&Ne.cd>0&&Y.push({id:`cd_${Date.now()}_${Math.random().toString(36).substr(2,5)}`,name:Ne.name,val:Ne.cd,max:Ne.cd,unit:Ne.cd_unit||"turn"})}}),z={...z,usage_counts:V};const oe=F.filter(pe=>pe.charId===W.instance_id).map(pe=>pe.effect),Xe=[...H.filter(pe=>pe.charId===W.instance_id).map(pe=>pe.cooldown),...Y],ve=[...z.cooldowns];return Xe.forEach(pe=>{ve.some(Ne=>Ne.name===pe.name)||ve.push(pe)}),{...z,active_effects:[...z.active_effects,...oe],cooldowns:ve}}),n(x);const X=[...c,b];if(h(X),le([]),f)if(v==="server"&&e)await ut(f,{sequence_log:X,participants_snapshot:x});else{const W=JSON.parse(localStorage.getItem(me)||"[]"),z=W.findIndex($=>$.id===f);z!==-1&&(W[z]={...W[z],sequence_log:X,participants_snapshot:x},localStorage.setItem(me,JSON.stringify(W)))}},ue=(u,b,x="root")=>{for(const m of u){if(m.id===b)return x;if(m.children&&m.children.length>0){const k=ue(m.children,b,m.id);if(k)return k}}return null},fe=(u,b)=>{for(const x of u){if(x.id===b)return x;const m=fe(x.children,b);if(m)return m}return null},je=u=>{var m,k;const{active:b}=u,x=(m=b.data.current)==null?void 0:m.type;x==="SOURCE_ABILITY"?ge(b.data.current):x==="NODE"&&Se((k=b.data.current)==null?void 0:k.node)},Ve=u=>{var m,k;const{active:b,over:x}=u;if(ge(null),Se(null),!!x){if(((m=b.data.current)==null?void 0:m.type)==="SOURCE_ABILITY"){const{charId:P,abilityId:F}=b.data.current,H={id:`node-${Date.now()}`,type:"action",data:{charId:P,abilityId:F,weaponId:""},children:[]};let X="root";const W=x.data.current||{};if(x.id==="root-canvas"?X="root":W.type==="CONTAINER"?X=W.nodeId:W.type==="NODE"&&(X=ue(ne,x.id)||"root"),X!=="root"){const z=fe(ne,X);if(z&&z.type==="combo"&&z.children.length>=2)return}le(z=>X==="root"?[...z,H]:Re(z,X,H));return}if(((k=b.data.current)==null?void 0:k.type)==="NODE"){const P=b.id,F=ue(ne,P)||"root";if(!P)return;let H="root";const X=x.id,W=x.data.current||{};if(x.id==="root-canvas"?H="root":W.type==="CONTAINER"?H=W.nodeId:W.type==="NODE"&&(H=ue(ne,X)||"root"),P===X)return;if(H!==F&&H!=="root"){const z=fe(ne,H);if(z&&z.type==="combo"&&z.children.length>=2)return}le(z=>{if(F===H)if(F==="root"){const $=z.findIndex(Y=>Y.id===P),V=z.findIndex(Y=>Y.id===X);return $!==-1&&V!==-1?Qt(z,$,V):z}else return _e(z,P,X);return se(z,P,F,H,X)})}}},se=(u,b,x,m,k)=>{let P=null;const F=W=>{const z=[];for(const $ of W){if($.id===b){P=$;continue}if($.children.length>0){const V=F($.children);if(V!==$.children){z.push({...$,children:V});continue}}z.push($)}return z},H=F(u);if(!P)return u;const X=(W,z)=>{if(m==="root"&&z){const $=[...W],V=$.findIndex(Y=>Y.id===k);return V!==-1?$.splice(V,0,P):$.push(P),$}return W.map($=>{if($.id===m){const V=[...$.children],Y=V.findIndex(oe=>oe.id===k);return Y!==-1?V.splice(Y,0,P):V.push(P),{...$,children:V}}return $.children.length>0?{...$,children:X($.children,!1)}:$})};return X(H,!0)},Re=(u,b,x)=>u.map(m=>m.id===b?{...m,children:[...m.children,x]}:m.children.length>0?{...m,children:Re(m.children,b,x)}:m),_e=(u,b,x)=>u.map(m=>{const k=m.children.findIndex(F=>F.id===b),P=m.children.findIndex(F=>F.id===x);return k!==-1&&P!==-1?{...m,children:Qt(m.children,k,P)}:m.children.length>0?{...m,children:_e(m.children,b,x)}:m}),Ae=u=>{const b=x=>x.filter(m=>m.id!==u).map(m=>({...m,children:b(m.children)}));le(x=>b(x))},nt=(u,b)=>{const x=m=>m.map(k=>k.id===u?{...k,data:{...k.data,...b}}:{...k,children:x(k.children)});le(m=>x(m))},Pe=u=>{if(u==="condition"){const b={id:`cond-${Date.now()}`,type:"condition",data:{},children:[]},x={id:`chain-${Date.now()}`,type:"logic_chain",children:[b]};le(m=>[...m,x])}else{const b={id:`block-${Date.now()}`,type:u,data:{},children:[]};le(x=>[...x,b])}},Le=u=>{const b={id:`cond-${Date.now()}`,type:"condition",data:{},children:[]},x=m=>m.map(k=>k.type==="logic_chain"&&k.children.some(F=>F.id===u)?{...k,children:[...k.children,b]}:k.children.length>0?{...k,children:x(k.children)}:k);le(m=>x(m))},rt=u=>{h(u)};return s.jsxs(Xo,{sensors:Ee,collisionDetection:ro,onDragStart:je,onDragEnd:Ve,children:[s.jsxs(Je,{isOpen:O==="CHAR_SELECT",onClose:re,title:" ",children:[s.jsxs("div",{className:"flex flex-col gap-3 mb-4",children:[s.jsxs("div",{className:"relative group",children:[s.jsx("input",{type:"text",placeholder:"  ...",value:g,onChange:u=>j(u.target.value),className:"w-full bg-[#0b0d12] border border-violet-900/40 rounded pl-9 pr-2 py-2 text-sm text-white focus:border-violet-500 focus:shadow-glow outline-none transition-all placeholder-slate-600 font-sans"}),s.jsx(is,{size:16,className:"absolute left-3 top-1/2 -translate-y-1/2 text-slate-500 group-focus-within:text-violet-400"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsxs("div",{className:"flex-1 relative group",children:[s.jsx(Un,{size:14,className:"absolute left-2 top-1/2 -translate-y-1/2 text-slate-500 pointer-events-none group-focus-within:text-violet-400"}),s.jsxs("select",{value:B,onChange:u=>{G(u.target.value),Q("All")},className:"w-full bg-[#0b0d12] border border-violet-900/40 rounded pl-8 pr-2 py-1.5 text-xs text-white appearance-none outline-none focus:border-violet-500 focus:shadow-glow transition-all",children:[s.jsx("option",{value:"All",className:"bg-[#0b0d12] text-slate-300",children:" "}),We.map(u=>s.jsx("option",{value:u,className:"bg-[#0b0d12] text-slate-300",children:u.toUpperCase()},u))]})]}),["NPC","",""].includes(B)&&s.jsxs("div",{className:"flex-1 relative animate-in fade-in slide-in-from-left-2 duration-300 group",children:[s.jsx(Un,{size:14,className:"absolute left-2 top-1/2 -translate-y-1/2 text-slate-500 pointer-events-none group-focus-within:text-violet-400"}),s.jsxs("select",{value:T,onChange:u=>Q(u.target.value),className:"w-full bg-[#0b0d12] border border-violet-900/40 rounded pl-8 pr-2 py-1.5 text-xs text-white appearance-none outline-none focus:border-violet-500 focus:shadow-glow transition-all",children:[s.jsx("option",{value:"All",className:"bg-[#0b0d12] text-slate-300",children:" "}),ke.map(u=>s.jsx("option",{value:u,className:"bg-[#0b0d12] text-slate-300",children:u.toUpperCase()},u))]})]})]})]}),ze.length===0?s.jsx("div",{className:"text-slate-500 italic text-center py-8 font-rune",children:"  "}):s.jsx("div",{className:"space-y-2 max-h-64 overflow-y-auto pr-1 custom-scrollbar",children:ze.map(u=>s.jsxs("button",{onClick:()=>un(u),className:`w-full text-left p-3 rounded border flex justify-between items-center transition-all duration-300 hover:shadow-glow ${bt(u.profile.faction)}`,children:[s.jsxs("div",{children:[s.jsx("div",{className:"font-bold font-rune",children:u.profile.name}),s.jsxs("div",{className:"text-[10px] flex gap-2 mt-0.5",children:[s.jsx("span",{className:"font-bold tracking-wide uppercase opacity-90",children:u.profile.faction}),["NPC","",""].includes(u.profile.faction)&&u.profile.npc_volume&&s.jsx("span",{className:"font-bold text-yellow-100 opacity-90 border-l border-white/20 pl-2",children:u.profile.npc_volume})]})]}),s.jsxs("div",{className:"text-right opacity-80",children:[s.jsxs("div",{className:"text-xs font-mono",children:["STR: ",u.stats.phys]}),s.jsxs("div",{className:"text-[10px] font-mono",children:["LVL ",u.profile.level]})]})]},u.id))})]}),s.jsx(Je,{isOpen:O==="BATTLE_LIST",onClose:re,title:e?" ":" ",footer:s.jsx("button",{onClick:Mt,className:"w-full py-2 bg-violet-900/50 border border-violet-500/50 text-white rounded font-bold hover:bg-violet-800 hover:shadow-glow transition-all uppercase font-rune tracking-widest",children:"  "}),children:s.jsxs("div",{className:"space-y-2 max-h-64 overflow-y-auto custom-scrollbar",children:[w.length===0&&s.jsx("div",{className:"text-center text-slate-500 py-4 italic",children:"  "}),w.map(u=>s.jsxs("div",{className:"w-full flex items-center justify-between p-3 bg-panel hover:bg-slate-900 border border-violet-900/30 hover:border-violet-500/50 rounded group mb-2 transition-all",children:[s.jsxs("button",{onClick:()=>He(u.id,u.source),className:"flex-1 text-left flex justify-between items-center",children:[s.jsxs("div",{className:"text-violet-100 font-bold font-rune flex items-center gap-2",children:[u.name||"  ",u.source==="local"?s.jsx("span",{title:"",children:s.jsx(mn,{size:12,className:"text-yellow-500"})}):s.jsx("span",{title:" ",children:s.jsx(Fn,{size:12,className:"text-emerald-500"})})]}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("span",{className:`text-[10px] px-2 py-0.5 rounded uppercase font-bold tracking-wider ${u.status==="active"?"bg-emerald-900/40 text-emerald-400 border border-emerald-800":u.status==="finished"?"bg-red-900/40 text-red-400 border border-red-800":"bg-slate-800 text-slate-400 border border-slate-700"}`,children:gt(u.status)})})]}),s.jsx("button",{onClick:b=>tt(u.id,u.source,b),className:"p-2 text-slate-500 hover:text-red-400 hover:bg-red-900/10 rounded transition-colors",title:" ",children:s.jsx(qe,{size:16})})]},u.id))]})}),s.jsx(Je,{isOpen:O==="CONFIRM_DELETE",onClose:Ie,title:" ",footer:s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:Ie,className:"px-4 py-2 text-slate-400 hover:text-white font-rune uppercase",children:""}),s.jsx("button",{onClick:$t,className:"px-4 py-2 bg-red-900/50 border border-red-500/50 text-white rounded hover:bg-red-800 hover:shadow-glow-red font-bold font-rune uppercase",children:" "})]}),children:s.jsx("p",{className:"text-red-300 font-sans",children:(Me==null?void 0:Me.source)==="server"?"   .        . ?":"    ?   ."})}),s.jsx(Je,{isOpen:O==="CREATE_BATTLE",onClose:re,title:" ",footer:s.jsx("button",{onClick:cn,className:"px-4 py-2 bg-violet-900/50 border border-violet-500/50 text-white rounded hover:bg-violet-800 hover:shadow-glow font-bold font-rune uppercase",children:""}),children:s.jsxs("div",{className:"flex flex-col gap-2",children:[s.jsx("label",{className:"text-sm text-slate-400 font-rune uppercase tracking-wider",children:" "}),s.jsx("input",{type:"text",value:C,onChange:u=>S(u.target.value),placeholder:".  -7",className:"bg-[#0b0d12] border border-violet-900/40 p-2 rounded text-white focus:border-violet-500 focus:shadow-glow outline-none transition-all font-sans",autoFocus:!0}),e&&s.jsxs("div",{className:"text-[10px] text-slate-500 flex items-center gap-1 mt-1",children:[": ",v==="server"?s.jsx(Fn,{size:10,className:"text-emerald-500"}):s.jsx(mn,{size:10,className:"text-yellow-500"})," ",v==="server"?" ":" "]})]})}),s.jsx(Je,{isOpen:O==="CONFIRM_SAVE",onClose:re,title:" ",footer:s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:re,className:"px-4 py-2 text-slate-400 hover:text-white font-rune uppercase",children:""}),s.jsx("button",{onClick:E,className:"px-4 py-2 bg-emerald-900/50 border border-emerald-500/50 text-white rounded hover:bg-emerald-800 hover:shadow-glow font-bold font-rune uppercase",children:""})]}),children:s.jsx("p",{className:"font-sans",children:"   . ,     ."})}),s.jsx(Je,{isOpen:O==="CONFIRM_END",onClose:re,title:" ",footer:s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:re,className:"px-4 py-2 text-slate-400 hover:text-white font-rune uppercase",children:""}),s.jsx("button",{onClick:xe,className:"px-4 py-2 bg-red-900/50 border border-red-500/50 text-white rounded hover:bg-red-800 hover:shadow-glow-red font-bold font-rune uppercase",children:" "})]}),children:s.jsx("p",{className:"text-red-400 font-sans",children:":      .   ."})}),s.jsx(Je,{isOpen:O==="FINALIZE_BATTLE",onClose:re,title:"  ",footer:s.jsxs(s.Fragment,{children:[s.jsx("button",{onClick:re,className:"px-4 py-2 text-slate-400 hover:text-white font-rune uppercase",children:""}),s.jsx("button",{onClick:ce,className:"px-4 py-2 bg-red-900/50 border border-red-500/50 text-white rounded hover:bg-red-800 hover:shadow-glow-red font-bold font-rune uppercase",children:R?"...":" "})]}),children:s.jsxs("div",{className:"space-y-4 font-sans",children:[s.jsx("p",{className:"text-sm text-slate-300",children:e?" .  ,        .":" . :   ,        ."}),e&&s.jsx("div",{className:"bg-[#0b0d12] border border-violet-900/30 rounded p-2 max-h-60 overflow-y-auto custom-scrollbar",children:t.filter(u=>u.medcard.injuries.length>0).length===0?s.jsx("div",{className:"text-slate-500 italic text-center p-2",children:"    ."}):t.filter(u=>u.medcard.injuries.length>0).map(u=>s.jsxs("div",{className:`flex items-center justify-between p-2 rounded mb-1 cursor-pointer border transition-all ${Z.has(u.instance_id)?"bg-red-900/20 border-red-500/50 shadow-glow-red":"bg-panel border-violet-900/20 opacity-60"}`,onClick:()=>pn(u.instance_id),children:[s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("div",{className:`w-4 h-4 rounded border flex items-center justify-center ${Z.has(u.instance_id)?"bg-red-600 border-red-400":"border-slate-600"}`,children:Z.has(u.instance_id)&&s.jsx("span",{className:"text-white text-xs font-bold",children:""})}),s.jsx("span",{className:"font-bold text-sm font-rune",children:u.profile.name})]}),s.jsxs("div",{className:"text-xs text-red-300 font-mono",children:[u.medcard.injuries.length," "]})]},u.instance_id))})]})}),s.jsx(Je,{isOpen:O==="ALERT",onClose:re,title:" ",footer:s.jsx("button",{onClick:re,className:"px-4 py-2 bg-slate-800 text-white rounded hover:bg-slate-700 font-rune uppercase",children:""}),children:s.jsx("p",{className:"font-sans",children:A})}),s.jsxs("div",{className:"h-screen w-full bg-slate-950 text-slate-300 font-sans p-4 flex flex-col overflow-hidden box-border relative",children:[s.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat pointer-events-none z-0 opacity-60",style:{backgroundImage:"url('https://vadwslmqajbbmklrhnzu.supabase.co/storage/v1/object/public/Juul-D-Page/battle_bg.jpg')"}}),s.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-slate-950 via-slate-950/60 to-slate-950/80 pointer-events-none z-0"}),s.jsxs("header",{className:"mb-4 flex items-center justify-between bg-slate-900/90 backdrop-blur-md p-4 rounded-lg border border-violet-900/30 shadow-lg relative overflow-hidden group shrink-0 h-20 z-10",children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-violet-900/10 to-transparent opacity-50 pointer-events-none"}),s.jsxs("div",{className:"flex items-center gap-4 relative z-10",children:[s.jsx("button",{onClick:()=>L("BATTLE_LIST"),className:"p-2 bg-slate-900 hover:bg-violet-900/40 rounded border border-violet-900/50 text-violet-300 hover:text-white transition-all hover:shadow-glow",title:"",children:s.jsx(ks,{size:18})}),s.jsx("button",{onClick:dn,className:"p-2 bg-slate-900 hover:bg-emerald-900/40 rounded border border-violet-900/50 text-violet-300 hover:text-emerald-300 hover:border-emerald-500/50 transition-all hover:shadow-glow",title:"",children:s.jsx(Rn,{size:18})}),e&&s.jsxs("div",{className:"flex items-center bg-black/40 rounded-lg p-1 border border-violet-900/30",children:[s.jsx("button",{onClick:()=>I("local"),className:`p-1.5 rounded transition-all ${v==="local"?"bg-yellow-900/40 text-yellow-400 shadow-glow-gold":"text-slate-600 hover:text-slate-400"}`,title:" ",children:s.jsx(mn,{size:14})}),s.jsx("div",{className:"w-px h-4 bg-white/10 mx-1"}),s.jsx("button",{onClick:()=>I("server"),className:`p-1.5 rounded transition-all ${v==="server"?"bg-violet-900/60 text-emerald-400 shadow-glow":"text-slate-600 hover:text-slate-400"}`,title:"  ",children:s.jsx(ss,{size:14})})]}),s.jsxs("div",{children:[s.jsx("input",{value:i,onChange:u=>xt(u.target.value),className:"bg-transparent text-xl font-bold font-rune text-transparent bg-clip-text bg-gradient-to-r from-violet-200 to-fuchsia-200 outline-none border-b border-transparent hover:border-violet-500/50 focus:border-violet-500 transition-all w-64 uppercase tracking-widest placeholder-violet-900"}),s.jsxs("div",{className:"text-xs text-slate-500 flex items-center gap-2 font-mono mt-1",children:[s.jsx("span",{children:":"}),s.jsx("span",{className:`uppercase font-bold tracking-wider ${o==="active"?"text-emerald-400 shadow-emerald-500/20 drop-shadow-sm":o==="finished"?"text-red-500":"text-amber-400"}`,children:gt(o)}),!e&&s.jsx("span",{className:"ml-2 text-[10px] bg-slate-800 px-2 py-0.5 rounded text-slate-400 border border-slate-700",children:" "})]})]})]}),s.jsxs("div",{className:"flex items-center gap-6 relative z-10",children:[s.jsxs("div",{className:"text-right mr-4",children:[s.jsx("div",{className:"text-[10px] text-violet-400 uppercase tracking-[0.2em] font-bold",children:""}),s.jsx("div",{className:"font-bold text-3xl font-rune text-white drop-shadow-md",children:r})]}),o!=="finished"&&s.jsxs(s.Fragment,{children:[s.jsxs("button",{onClick:Lt,className:"flex items-center gap-2 bg-slate-900 hover:bg-emerald-900/30 text-emerald-400 border border-emerald-900/50 hover:border-emerald-500/50 px-5 py-2 rounded-sm font-bold font-rune uppercase text-xs tracking-widest transition-all hover:shadow-glow",children:[s.jsx(ur,{size:14,fill:"currentColor"})," ",r===0?" ":". "]}),s.jsxs("button",{onClick:hn,className:"flex items-center gap-2 bg-slate-900 hover:bg-red-900/30 text-red-400 border border-red-900/50 hover:border-red-500/50 px-5 py-2 rounded-sm font-bold font-rune uppercase text-xs tracking-widest transition-all hover:shadow-glow-red",children:[s.jsx(dr,{size:14,fill:"currentColor"})," "]})]})]})]}),s.jsxs("main",{className:"flex-1 min-h-0 grid grid-cols-1 min-[1150px]:grid-cols-12 gap-4 relative z-10",children:[s.jsxs("div",{className:"col-span-12 min-[1150px]:col-span-3 h-full flex flex-col min-h-0 bg-slate-900/85 backdrop-blur-sm border border-violet-900/20 rounded-lg overflow-hidden",children:[s.jsxs("div",{className:"flex items-center justify-between p-3 border-b border-violet-900/30 bg-[#020408]/50 shrink-0",children:[s.jsx("h2",{className:"text-xs font-bold text-violet-400 uppercase tracking-widest font-rune",children:""}),s.jsx("button",{onClick:()=>L("CHAR_SELECT"),className:"text-violet-400 hover:text-white transition-all",children:s.jsx(Jr,{size:18})})]}),s.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar p-1",children:s.jsx(Oa,{participants:t,onToggleEquip:it,onRemoveParticipant:lt,onAddInjury:an,onRemoveInjury:ln,onAddDebuff:Ye,onRemoveEffect:At,onRemoveCooldown:Tt,onUpdateParticipant:De})})]}),s.jsx("div",{className:"col-span-12 min-[1150px]:col-span-6 h-full flex flex-col gap-3 min-h-0",children:s.jsxs("div",{className:"flex-1 relative border border-violet-900/20 rounded bg-slate-900/80 backdrop-blur-sm h-full overflow-hidden flex flex-col",children:[s.jsx("div",{className:"absolute top-0 left-0 w-4 h-4 border-t border-l border-violet-800/30 pointer-events-none"}),s.jsx("div",{className:"absolute top-0 right-0 w-4 h-4 border-t border-r border-violet-800/30 pointer-events-none"}),s.jsx(za,{tree:ne,participants:t,onRemove:Ae,onUpdateData:nt,onAddCombo:()=>Pe("combo"),onAddCondition:()=>Pe("condition"),onAddDivider:()=>Pe("divider"),onClear:()=>le([]),onAddLogicSibling:Le,onCommit:Oe})]})}),s.jsx("div",{className:"col-span-12 min-[1150px]:col-span-3 h-full flex flex-col min-h-0",children:s.jsx(Pa,{logs:c,currentRound:r,participants:t,onUpdateLogs:rt,onUpdateParticipant:De,onRollback:fn})})]})]}),s.jsxs(ua,{children:[Ue&&Ue.type==="SOURCE_ABILITY"?s.jsx("div",{className:"bg-violet-900/90 border border-violet-400 text-white px-3 py-1.5 rounded shadow-glow opacity-90 cursor-grabbing font-bold text-sm font-rune tracking-wide backdrop-blur-sm",children:"+  "}):null,at?s.jsx("div",{className:"bg-panel border border-violet-500 rounded p-2 shadow-2xl opacity-80 rotate-2 w-48 backdrop-blur-md",children:s.jsx("div",{className:"h-4 bg-violet-900/50 rounded w-3/4 mb-2 animate-pulse"})}):null]})]})};export{Za as default};
